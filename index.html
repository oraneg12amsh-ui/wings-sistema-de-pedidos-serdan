<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Wing's House - MenÃº Digital y Pedidos</title>
    <meta name="description" content="Explora nuestro menÃº de alitas, boneless, paquetes y mÃ¡s. Haz tu pedido fÃ¡cilmente y te lo enviamos por WhatsApp.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        'primary': { '50': '#fef2f2', '100': '#fee2e2', '200': '#fecaca', '300': '#fca5a5', '400': '#f87171', '500': '#ef4444', '600': '#dc2626', '700': '#b91c1c', '800': '#991b1b', '900': '#7f1d1d', '950': '#450a0a' },
                        'slate': { '50': '#f8fafc', '100': '#f1f5f9', '200': '#e2e8f0', '300': '#cbd5e1', '400': '#94a3b8', '500': '#64748b', '600': '#475569', '700': '#334155', '800': '#1e293b', '900': '#0f172a' },
                        'gold': { '400': '#facc15', '500': '#eab308', '600': '#ca8a04' }
                    }
                }
            }
        };
    </script>
    <style>
        body { background-color: #f8fafc; background-image: radial-gradient(#cbd5e1 1px, transparent 1px), radial-gradient(#cbd5e1 1px, transparent 1px); background-position: 0 0, 25px 25px; background-size: 50px 50px; position: relative; overflow-x: hidden; }
        #intro-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, #fff 0%, #fee2e2 100%); z-index: 9999; display: flex; justify-content: center; align-items: center; opacity: 1; transition: opacity 0.5s ease-out, visibility 0.5s; }
        #intro-overlay.fade-out { opacity: 0; visibility: hidden; pointer-events: none; }
        .xbox-container { position: relative; width: 200px; height: 200px; display: flex; justify-content: center; align-items: center; }
        .orb-glow { position: absolute; width: 0; height: 0; background: radial-gradient(circle, rgba(220,38,38,0.8) 0%, rgba(255,255,255,0) 70%); border-radius: 50%; animation: orb-expand 1s ease-out forwards 0.2s; }
        .ring-swoosh { position: absolute; width: 150px; height: 150px; border-radius: 50%; border: 4px solid transparent; opacity: 0; }
        .ring-red { border-top-color: #dc2626; border-right-color: #ef4444; transform: rotateX(60deg) rotateY(10deg); animation: swoosh-in 0.8s cubic-bezier(0.19, 1, 0.22, 1) forwards; }
        .ring-green { border-bottom-color: #16a34a; border-left-color: #22c55e; transform: rotateX(60deg) rotateY(-10deg); width: 140px; height: 140px; animation: swoosh-in 0.8s cubic-bezier(0.19, 1, 0.22, 1) forwards 0.1s; }
        .ring-gold { border-top-color: #eab308; border-left-color: transparent; width: 160px; height: 160px; transform: rotateX(70deg); animation: swoosh-in-spin 1s cubic-bezier(0.19, 1, 0.22, 1) forwards 0.05s; }
        .intro-flash { position: absolute; width: 100%; height: 100%; background: radial-gradient(circle, #fff 10%, transparent 60%); opacity: 0; transform: scale(0); animation: flash-burst 0.3s ease-out forwards 0.7s; }
        .intro-brand { position: absolute; text-align: center; opacity: 0; transform: scale(0.8); animation: brand-appear 0.6s ease-out forwards 0.8s; }
        .intro-brand-icon { position: relative; }
        .intro-brand-icon::before { content: 'ğŸ…'; position: absolute; top: -20px; right: -10px; font-size: 2.5rem; transform: rotate(15deg); z-index: 20; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2)); }
        @keyframes orb-expand { 0% { width: 0; height: 0; opacity: 0; } 50% { width: 300px; height: 300px; opacity: 0.6; } 100% { width: 200px; height: 200px; opacity: 0.2; } }
        @keyframes swoosh-in { 0% { opacity: 0; transform: rotateX(60deg) rotateZ(0deg) scale(3); } 50% { opacity: 1; } 100% { opacity: 0; transform: rotateX(60deg) rotateZ(360deg) scale(0.5); } }
        @keyframes swoosh-in-spin { 0% { opacity: 0; transform: rotateX(70deg) rotateZ(-90deg) scale(3); } 50% { opacity: 1; } 100% { opacity: 0; transform: rotateX(70deg) rotateZ(180deg) scale(0.5); } }
        @keyframes flash-burst { 0% { opacity: 0; transform: scale(0); } 50% { opacity: 1; transform: scale(1.5); } 100% { opacity: 0; transform: scale(2); } }
        @keyframes brand-appear { 0% { opacity: 0; transform: scale(0.8); filter: blur(10px); } 100% { opacity: 1; transform: scale(1); filter: blur(0); } }
        .snowflake { position: fixed; top: -10px; z-index: 10000; color: #dbeafe; font-size: 1em; font-family: Arial, sans-serif; text-shadow: 0 0 5px #000; user-select: none; pointer-events: none; animation-name: snowflakes-fall, snowflakes-shake; animation-duration: 10s, 3s; animation-timing-function: linear, ease-in-out; animation-iteration-count: infinite, infinite; animation-play-state: running, running; }
        @keyframes snowflakes-fall { 0% { top: -10%; } 100% { top: 100%; } }
        @keyframes snowflakes-shake { 0%, 100% { transform: translateX(0px); } 50% { transform: translateX(80px); } }
        .snowflake:nth-of-type(0) { left: 1%; animation-delay: 0s, 0s; } .snowflake:nth-of-type(1) { left: 10%; animation-delay: 1s, 1s; } .snowflake:nth-of-type(2) { left: 20%; animation-delay: 6s, 0.5s; } .snowflake:nth-of-type(3) { left: 30%; animation-delay: 4s, 2s; } .snowflake:nth-of-type(4) { left: 40%; animation-delay: 2s, 2s; } .snowflake:nth-of-type(5) { left: 50%; animation-delay: 8s, 3s; } .snowflake:nth-of-type(6) { left: 60%; animation-delay: 6s, 2s; } .snowflake:nth-of-type(7) { left: 70%; animation-delay: 2.5s, 1s; } .snowflake:nth-of-type(8) { left: 80%; animation-delay: 1s, 0s; } .snowflake:nth-of-type(9) { left: 90%; animation-delay: 3s, 1.5s; }
        .christmas-header-icon::after { content: 'ğŸ…'; position: absolute; top: -15px; right: -10px; font-size: 24px; transform: rotate(15deg); }
        .cart-mobile-view { position: fixed; bottom: 0; left: 0; right: 0; z-index: 50; transform: translateY(100%); transition: transform 0.3s ease-in-out; max-height: 80vh; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .cart-mobile-view.active { transform: translateY(0); }
        .highlight-cart { animation: pulse-border 2s 2; border: 2px solid #dc2626; }
        .highlight-cart-mobile { animation: pulse-bg 2s 2; }
        @keyframes pulse-border { 0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); } 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); } }
        @keyframes pulse-bg { 0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(220, 38, 38, 0); } 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); } }
        .category-filter-btn { padding: 8px 16px; border-radius: 9999px; background-color: #fff; color: #334155; font-weight: 600; transition: all 0.2s ease-in-out; border: 1px solid #e2e8f0; cursor: pointer; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .category-filter-btn:hover { background-color: #f1f5f9; border-color: #cbd5e1; }
        .category-filter-btn.active { background-color: #dc2626; color: white; border-color: #b91c1c; box-shadow: 0 4px 6px -1px rgba(220, 38, 38, 0.3); }
        .extras-modal-grid { max-height: 40vh; overflow-y: auto; }
        .add-extra-btn:disabled { background-color: #15803d; color: white; opacity: 1; cursor: not-allowed; }
        .coupon-applied-tag { background-color: #dcfce7; color: #166534; border-color: #86efac; }
        .coupon-error-msg { color: #dc2626; }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-content { animation: fadeInScale 0.2s ease-out; }
        .quantity-btn { background-color: #f1f5f9; color: #475569; width: 24px; height: 24px; border-radius: 9999px; font-weight: bold; display: flex; align-items: center; justify-content: center; transition: background-color 0.2s; border: 1px solid #e2e8f0; }
        .quantity-btn:hover { background-color: #e2e8f0; color: #dc2626; border-color: #dc2626; }
        .add-to-cart-btn:disabled { background-color: #94a3b8; cursor: not-allowed; opacity: 0.7; }
        #product-list > div { transition: transform 0.2s, box-shadow 0.2s; border: 1px solid transparent; }
        #product-list > div:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); border-color: #fca5a5; }
        .toggle-checkbox:checked { right: 0; border-color: #68D391; }
        .toggle-checkbox:checked + .toggle-label { background-color: #68D391; }
        #toast-container { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); z-index: 100; pointer-events: none; width: 90%; max-width: 400px; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: rgba(30, 41, 59, 0.95); backdrop-filter: blur(5px); color: white; padding: 12px 20px; border-radius: 12px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); opacity: 0; transform: translateY(20px); transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55); display: flex; align-items: center; justify-content: space-between; font-weight: 500; font-size: 0.95rem; }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast-icon { margin-right: 10px; font-size: 1.2rem; }
        #giveaway-section { animation: slideDown 0.5s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .shimmer-btn { position: relative; overflow: hidden; }
        .shimmer-btn::after { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent); animation: shimmer 2s infinite; }
        @keyframes shimmer { 100% { left: 100%; } }
    </style>
</head>
<body class="font-sans p-4 md:p-8 text-slate-700 pb-20">
    <div id="intro-overlay"><div class="xbox-container"><div class="orb-glow"></div><div class="ring-swoosh ring-red"></div><div class="ring-swoosh ring-green"></div><div class="ring-swoosh ring-gold"></div><div class="intro-flash"></div><div class="intro-brand"><div class="intro-brand-icon bg-green-600 text-white p-3 rounded-full shadow-lg mb-2 mx-auto w-16 h-16 flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-10 h-10"><path d="M12 2.5l-8 12h5l-4 8h14l-4-8h5L12 2.5z"></path><path d="M12 21.5v-3"></path></svg></div><h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Wing's House</h1><p class="text-primary-600 font-semibold text-sm mt-1">Â¡Feliz Navidad y AÃ±o Nuevo!</p></div></div></div>
    <div class="snowflakes" aria-hidden="true"><div class="snowflake">â…</div><div class="snowflake">â†</div><div class="snowflake">â…</div><div class="snowflake">â†</div><div class="snowflake">â…</div><div class="snowflake">â†</div><div class="snowflake">â…</div><div class="snowflake">â†</div><div class="snowflake">â…</div><div class="snowflake">â†</div></div>
    <div id="toast-container"></div>
    <header class="text-center mb-8 max-w-3xl mx-auto relative z-10">
        <div class="flex justify-center items-center gap-4 mb-4"><div class="bg-white border-2 border-primary-500 text-primary-600 p-3 rounded-full shadow-lg christmas-header-icon relative"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-10 h-10"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path><line x1="16" y1="8" x2="2" y2="22"></line><line x1="17.5" y1="15" x2="9" y2="15"></line></svg></div><div><h1 class="text-5xl font-extrabold text-slate-900 tracking-tight flex items-center justify-center gap-2">Wing's House <span class="text-3xl">ğŸ„</span></h1><p class="text-slate-600 mt-1 text-lg">Â¡Feliz Navidad y AÃ±o Nuevo!</p></div></div>
        <div id="countdown-container" class="flex flex-col items-center mt-4 mb-6">
            <p id="countdown-label" class="text-sm font-semibold text-primary-600 mb-2 uppercase tracking-wide">Faltan para el 2026:</p>
            <div id="countdown-timer" class="flex justify-center gap-3 text-slate-700"><div class="flex flex-col items-center bg-white border border-primary-200 shadow-md rounded-lg p-2 min-w-[60px]"><span id="days" class="text-2xl font-extrabold text-primary-600 leading-none">00</span><span class="text-[10px] font-bold uppercase text-slate-400 mt-1">DÃ­as</span></div><div class="flex flex-col items-center bg-white border border-primary-200 shadow-md rounded-lg p-2 min-w-[60px]"><span id="hours" class="text-2xl font-extrabold text-primary-600 leading-none">00</span><span class="text-[10px] font-bold uppercase text-slate-400 mt-1">Hrs</span></div><div class="flex flex-col items-center bg-white border border-primary-200 shadow-md rounded-lg p-2 min-w-[60px]"><span id="minutes" class="text-2xl font-extrabold text-primary-600 leading-none">00</span><span class="text-[10px] font-bold uppercase text-slate-400 mt-1">Min</span></div><div class="flex flex-col items-center bg-white border border-primary-200 shadow-md rounded-lg p-2 min-w-[60px]"><span id="seconds" class="text-2xl font-extrabold text-primary-600 leading-none">00</span><span class="text-[10px] font-bold uppercase text-slate-400 mt-1">Seg</span></div></div>
            <div id="new-year-message" class="hidden animate-bounce text-center"><span class="text-3xl font-extrabold text-gold-500 block mb-1">âœ¨ Â¡Feliz 2026! âœ¨</span><span class="text-sm text-slate-500">Â¡Que comiencen los regalos!</span></div>
        </div>
        <div id="giveaway-teaser" class="max-w-6xl mx-auto mt-6 mb-8">
            <div class="text-center mb-4"><h3 class="text-xl font-bold text-slate-700 flex items-center justify-center gap-2"><span class="text-2xl">ğŸ‘€</span> Â¡Mira lo que viene!</h3><p class="text-sm text-slate-500">Estos regalos se desbloquearÃ¡n cuando el contador llegue a cero.</p></div>
            <div id="teaser-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>
        </div>
        <div id="giveaway-section" class="hidden max-w-6xl mx-auto mb-8">
            <div class="bg-gradient-to-r from-red-600 to-red-500 rounded-xl shadow-2xl p-4 text-white border-4 border-gold-400 mb-6"><div class="text-center mb-4"><h3 class="text-2xl font-extrabold mb-1 flex items-center justify-center gap-2"><span class="text-3xl">ğŸ</span> Regalos de AÃ±o Nuevo</h3><p class="text-red-100 text-sm">Â¡Elige tu regalo! Solo puedes reclamar uno. <br>Tiempo restante: <span id="giveaway-timer" class="font-mono font-bold text-white tracking-widest text-lg">03:00</span></p></div><div id="giveaway-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></div></div>
        </div>
        <p class="text-slate-600 text-lg bg-white/80 inline-block px-4 py-1 rounded-full backdrop-blur-sm shadow-sm mt-4">Selecciona tus productos y completa tu pedido</p>
    </header>
    <div id="store-closed-banner" class="max-w-6xl mx-auto bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-lg shadow-lg mb-8 hidden" role="alert"><div class="flex"><div class="py-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500 mr-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div><div><p class="font-bold">Â¡Estamos cerrados!</p><p id="store-closed-message" class="text-sm">Nuestro horario de atenciÃ³n es de 1:00 PM a 10:00 PM. Puedes ver el menÃº, pero no se podrÃ¡n tomar pedidos hasta que abramos.</p></div></div></div>
    <div id="holiday-notice-banner" class="max-w-6xl mx-auto bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-8 rounded-lg shadow-md hidden"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg></div><div class="ml-3"><h3 class="text-lg font-medium text-yellow-800">âœ¨ Aviso Importante: Horario de Fin de AÃ±o âœ¨</h3><div class="mt-2 text-sm text-yellow-700"><p>A toda nuestra querida clientela:</p><p class="mt-1">Queremos informarles que, con motivo de las celebraciones de fin de aÃ±o y para permitir que nuestro equipo disfrute con sus familias, suspenderemos labores los dÃ­as:</p><p class="font-bold mt-1 text-yellow-900">ğŸ—“ï¸ 30 y 31 de Diciembre</p><p class="mt-1">Reanudaremos nuestro servicio habitual y entregas a domicilio el dÃ­a:</p><p class="font-bold mt-1 text-green-700">âœ… 1 de Enero de 2026</p><p class="mt-2">Agradecemos profundamente su preferencia durante todo este aÃ±o y les deseamos un prÃ³spero AÃ±o Nuevo lleno de Ã©xitos y momentos felices. Â¡Nos vemos en el 2026! ğŸ¥‚</p><p class="font-bold mt-2 text-primary-700 text-base">Wings Aliens</p></div></div></div></div>
    <div class="max-w-6xl mx-auto bg-white/90 backdrop-blur-sm rounded-xl shadow-lg p-6 mb-8 border border-primary-200 relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-red-500 via-green-500 to-red-500"></div><h2 class="text-2xl font-semibold text-slate-800 mb-4 text-center">Â¿CÃ³mo ordenar?</h2><div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 text-center"><div class="flex flex-col items-center p-4"><div class="bg-green-600 text-white rounded-full h-16 w-16 flex items-center justify-center mb-3 shadow-md border-2 border-white ring-2 ring-green-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12" /></svg></div><h3 class="font-semibold text-slate-700">1. Selecciona Productos</h3><p class="text-sm text-slate-600 mt-1">Explora el menÃº y aÃ±ade lo que te guste.</p></div><div class="flex flex-col items-center p-4"><div class="bg-primary-600 text-white rounded-full h-16 w-16 flex items-center justify-center mb-3 shadow-md border-2 border-white ring-2 ring-primary-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" /></svg></div><h3 class="font-semibold text-slate-700">2. Revisa tu Carrito</h3><p class="text-sm text-slate-600 mt-1">Verifica tu selecciÃ³n de productos.</p></div><div class="flex flex-col items-center p-4"><div class="bg-green-600 text-white rounded-full h-16 w-16 flex items-center justify-center mb-3 shadow-md border-2 border-white ring-2 ring-green-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" /></svg></div><h3 class="font-semibold text-slate-700">3. Completa tus Datos</h3><p class="text-sm text-slate-600 mt-1">Ingresa tu nombre y direcciÃ³n.</p></div><div class="flex flex-col items-center p-4"><div class="bg-primary-600 text-white rounded-full h-16 w-16 flex items-center justify-center mb-3 shadow-md border-2 border-white ring-2 ring-primary-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="currentColor" viewBox="0 0 16 16"><path d="M13.601 2.326A7.85 7.85 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.9 7.9 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.9 7.9 0 0 0 13.6 2.326zM7.994 14.521a6.6 6.6 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.56 6.56 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592m3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.ejemplo.ejemplo3.ejemplo3 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232"/></svg></div><h3 class="font-semibold text-slate-700">4. Confirma en WhatsApp</h3><p class="text-sm text-slate-600 mt-1">Se abrirÃ¡ un chat con tu pedido listo.</p></div></div></div>
    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8 relative z-10">
        <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6 border-t-4 border-green-500"><h2 class="text-2xl font-semibold text-slate-800 mb-4 flex items-center gap-2">Productos Disponibles <span class="text-xl">ğŸ</span></h2>
            <div class="sticky top-0 z-40 bg-slate-50/95 backdrop-blur-sm -mx-6 px-6 py-4 border-b border-gray-100 shadow-sm transition-all"><div class="relative mb-4"><input type="search" id="search-bar" placeholder="Buscar producto..." class="w-full border border-slate-300 rounded-lg p-3 pl-10 focus:outline-none focus:ring-2 focus:ring-primary-500 transition-shadow shadow-sm hover:shadow-md"><div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg></div></div><div class="flex flex-wrap justify-center gap-2" id="category-filters"></div></div>
            <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mt-6"></div>
        </div>
        <div id="cart-section" class="bg-white rounded-xl shadow-lg p-6 h-fit sticky top-8 lg:block hidden transition-all duration-300 border-t-4 border-primary-500"><h2 class="text-2xl font-semibold text-slate-800 mb-6 flex justify-between items-center">Tu Carrito ğŸ›’ <button id="clear-cart-button" class="text-sm text-red-500 hover:text-red-700 transition-colors duration-200 hidden">Vaciar Carrito</button></h2><div id="cart-list" class="space-y-2 mb-6 min-h-[60px]"><p id="empty-cart-message" class="text-slate-500 text-center pt-4">El carrito estÃ¡ vacÃ­o.</p></div><div id="coupon-area-desktop" class="border-t pt-4"><div><select id="coupon-select-desktop" class="w-full border border-slate-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-primary-500"><option value="">Selecciona un cupÃ³n...</option><option value="DESCUENTO30">DESCUENTO30</option><option value="ALITASGRATIS">ALITASGRATIS</option><option value="PAPASGRATIS">PAPASGRATIS</option><option value="JUEVESBONELESS">JUEVESBONELESS</option></select></div><p class="text-xs text-slate-500 italic mt-2">SÃ³lo serÃ¡ vÃ¡lido al entregar su cupÃ³n fÃ­sico.</p><div id="coupon-message-desktop" class="text-sm mt-2"></div></div><div class="border-t pt-4 mt-4"><div class="flex justify-between items-center text-xl font-bold text-slate-800"><span>Subtotal:</span><span id="cart-subtotal">$0.00</span></div><div class="flex justify-between items-center text-slate-600 mt-2"><span>Costo de envÃ­o:</span><span id="shipping-cost">Â¡GRATIS!</span></div><p id="shipping-promo-desktop" class="text-sm text-primary-700 font-semibold text-center mt-2 hidden"></p><div id="discount-row-desktop" class="flex justify-between items-center text-green-600 mt-2 font-semibold hidden"><span>Descuento:</span><span id="cart-discount-desktop">$0.00</span></div><div class="flex justify-between items-center text-2xl font-bold text-slate-800 mt-4"><span>Total:</span><span id="cart-total">$0.00</span></div></div><button id="checkout-button" class="w-full bg-primary-600 text-white font-bold py-3 px-4 rounded-lg mt-6 hover:bg-primary-700 transition-colors duration-300 shadow-md disabled:bg-primary-400 disabled:cursor-not-allowed" disabled>Finalizar Pedido</button></div>
    </div>
    <button id="mobile-cart-button" class="lg:hidden fixed bottom-4 right-4 bg-primary-600 text-white font-bold p-4 rounded-full shadow-lg transition-transform transform hover:scale-110 active:scale-95 z-50 ring-4 ring-white"><div class="relative"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" /></svg><span id="mobile-cart-count" class="absolute -top-3 -right-3 bg-green-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center border-2 border-white hidden shadow-sm">0</span></div></button>
    <div id="cart-mobile-view" class="cart-mobile-view bg-white rounded-t-xl shadow-lg p-6 border-t-4 border-primary-500"><h2 class="text-2xl font-semibold text-slate-800 mb-6 flex justify-between items-center">Tu Carrito ğŸ›’ <button id="close-mobile-cart-button" class="text-sm text-slate-500 hover:text-slate-700"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg></button></h2><div id="cart-list-mobile" class="space-y-2 mb-6"><p id="empty-cart-message-mobile" class="text-slate-500 text-center">El carrito estÃ¡ vacÃ­o.</p></div><div id="coupon-area-mobile" class="border-t pt-4"><div><select id="coupon-select-mobile" class="w-full border border-slate-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-primary-500"><option value="">Selecciona un cupÃ³n...</option><option value="DESCUENTO30">DESCUENTO30</option><option value="ALITASGRATIS">ALITASGRATIS</option><option value="PAPASGRATIS">PAPASGRATIS</option><option value="JUEVESBONELESS">JUEVESBONELESS</option></select></div><p class="text-xs text-slate-500 italic mt-2">SÃ³lo serÃ¡ vÃ¡lido al entregar su cupÃ³n fÃ­sico.</p><div id="coupon-message-mobile" class="text-sm mt-2"></div></div><div class="border-t pt-4 mt-4"><div class="flex justify-between items-center text-xl font-bold text-slate-800"><span>Subtotal:</span><span id="cart-subtotal-mobile">$0.00</span></div><div class="flex justify-between items-center text-slate-600 mt-2"><span>Costo de envÃ­o:</span><span id="shipping-cost-mobile">Â¡GRATIS!</span></div><p id="shipping-promo-mobile" class="text-sm text-primary-700 font-semibold text-center mt-2 hidden"></p><div id="discount-row-mobile" class="flex justify-between items-center text-green-600 mt-2 font-semibold hidden"><span>Descuento:</span><span id="cart-discount-mobile">$0.00</span></div><div class="flex justify-between items-center text-2xl font-bold text-slate-800 mt-4"><span>Total:</span><span id="cart-total-mobile">$0.00</span></div></div><button id="checkout-button-mobile" class="w-full bg-primary-600 text-white font-bold py-3 px-4 rounded-lg mt-6 hover:bg-primary-700 shadow-md disabled:bg-primary-400 disabled:cursor-not-allowed" disabled>Finalizar Pedido</button></div>
    <div id="claim-giveaway-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 hidden z-50"><div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-8 modal-content border-t-8 border-gold-400"><div class="flex justify-between items-center mb-4"><h3 class="text-2xl font-bold text-slate-800">ğŸ‰ Reclamar Premio</h3><button id="close-giveaway-modal" class="text-slate-400 hover:text-slate-600"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg></button></div><p class="text-slate-600 mb-4" id="giveaway-offer-text">Ingresa tus datos para generar tu cupÃ³n. Â¡Se enviarÃ¡ a nuestro WhatsApp para validar!</p><form id="giveaway-form" class="space-y-4"><input type="hidden" name="coupon_id" id="giveaway-coupon-id"><input type="hidden" name="coupon_offer" id="giveaway-coupon-offer"><div><label class="block text-slate-700 font-semibold mb-1">Nombre</label><input type="text" name="winner_name" class="w-full border p-2 rounded" required></div><div><label class="block text-slate-700 font-semibold mb-1">DirecciÃ³n</label><input type="text" name="winner_address" class="w-full border p-2 rounded" required></div><div><label class="block text-slate-700 font-semibold mb-1">Detalles</label><input type="text" name="winner_details" class="w-full border p-2 rounded" placeholder="Ej. Casa verde"></div><button type="submit" class="w-full bg-gold-500 text-white font-bold py-3 rounded-lg shadow-md hover:bg-gold-600">Â¡ENVIAR Y RECLAMAR!</button></form></div></div>
    <div id="admin-login-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 hidden z-50"><div class="bg-white rounded-xl shadow-xl w-full max-w-sm p-6 modal-content"><h3 class="text-xl font-bold text-slate-800 mb-4 text-center">Acceso Administrador</h3><input type="password" id="admin-password" placeholder="ContraseÃ±a" class="w-full border border-slate-300 rounded-lg p-2 mb-4 focus:outline-none focus:ring-2 focus:ring-primary-500"><div class="flex justify-between gap-2"><button id="admin-cancel-login" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400">Cancelar</button><button id="admin-submit-login" class="flex-1 bg-primary-600 text-white py-2 rounded-lg hover:bg-primary-700">Entrar</button></div></div></div>
    <div id="admin-panel-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-2 sm:p-4 hidden z-50"><div class="bg-white rounded-xl shadow-xl w-full max-w-7xl flex flex-col h-[95vh] sm:h-[90vh] modal-content"><div class="flex justify-between items-center p-6 border-b border-gray-100"><h3 class="text-2xl sm:text-3xl font-bold text-slate-800">Administrar Tienda</h3><button id="admin-close-panel" class="text-slate-400 hover:text-slate-600 transition-colors p-2 rounded-full hover:bg-slate-100"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg></button></div><div class="overflow-y-auto flex-1 p-6 bg-slate-50"><div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200 mb-6 flex justify-between items-center"><div><h4 class="font-bold text-yellow-800">Prueba de Evento 2026</h4><p class="text-xs text-yellow-700">Activa forzadamente el sorteo de aÃ±o nuevo para probar.</p></div><button id="admin-test-giveaway" class="bg-yellow-500 text-white px-4 py-2 rounded-lg text-sm font-bold shadow hover:bg-yellow-600">Simular AÃ±o Nuevo</button></div><div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 mb-8"><h4 class="text-lg font-bold text-slate-700 mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>Horario y Apertura</h4><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-100"><div class="flex flex-col"><span class="font-semibold text-slate-700">Horario AutomÃ¡tico</span><span class="text-xs text-slate-500">Abrir/cerrar segÃºn la hora configurada</span></div><div class="relative inline-block w-14 align-middle select-none"><input type="checkbox" id="admin-toggle-schedule" class="toggle-checkbox absolute block w-7 h-7 rounded-full bg-white border-4 appearance-none cursor-pointer border-gray-300 transition-all duration-300"/><label for="admin-toggle-schedule" class="toggle-label block overflow-hidden h-7 rounded-full bg-gray-300 cursor-pointer transition-colors duration-300"></label></div></div><div id="admin-manual-status-container" class="flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-100 transition-opacity"><div class="flex flex-col"><span class="font-semibold text-slate-700">Forzar Apertura</span><span class="text-xs text-slate-500">Abrir tienda manualmente</span></div><div class="relative inline-block w-14 align-middle select-none"><input type="checkbox" id="admin-toggle-manual-open" class="toggle-checkbox absolute block w-7 h-7 rounded-full bg-white border-4 appearance-none cursor-pointer border-gray-300 transition-all duration-300"/><label for="admin-toggle-manual-open" class="toggle-label block overflow-hidden h-7 rounded-full bg-gray-300 cursor-pointer transition-colors duration-300"></label></div></div><div class="flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-100 mt-4"><div class="flex flex-col"><span class="font-semibold text-slate-700">Aviso de Fin de AÃ±o</span><span class="text-xs text-slate-500">Mostrar mensaje de vacaciones</span></div><div class="relative inline-block w-14 align-middle select-none"><input type="checkbox" id="admin-toggle-holiday" class="toggle-checkbox absolute block w-7 h-7 rounded-full bg-white border-4 appearance-none cursor-pointer border-gray-300 transition-all duration-300"/><label for="admin-toggle-holiday" class="toggle-label block overflow-hidden h-7 rounded-full bg-gray-300 cursor-pointer transition-colors duration-300"></label></div></div></div></div><div class="mb-4 flex justify-between items-end"><div><h4 class="text-lg font-bold text-slate-700">Disponibilidad de Productos</h4><p class="text-sm text-slate-500 mt-1">Gestiona quÃ© productos estÃ¡n visibles en el menÃº.</p></div></div><div id="admin-product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div></div><div class="p-4 border-t border-gray-100 bg-white rounded-b-xl flex justify-end"><button id="admin-finish-btn" class="bg-primary-600 text-white font-bold py-3 px-8 rounded-xl hover:bg-primary-700 shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-0.5">Guardar y Salir</button></div></div></div>
    <footer class="mt-12 py-6 text-center border-t border-slate-200"><p class="text-slate-400 text-sm">Â© 2024 Wing's House</p><button id="admin-login-btn" class="mt-2 text-slate-300 hover:text-slate-500 transition-colors p-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg></button></footer>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyC5FgnZkkzjP3MwWuM9QUBeuhHTnqYPZ3M", authDomain: "sistema-de-pedidos-95bce.firebaseapp.com", projectId: "sistema-de-pedidos-95bce", storageBucket: "sistema-de-pedidos-95bce.firebasestorage.app", messagingSenderId: "559612407232", appId: "1:559612407232:web:43e0841bca9ef9d472ec25", measurementId: "G-DXV79WQJNM" };
        let app, auth, db, firebaseReady = false; const appId = 'wings-house-v1';
        try { if (firebaseConfig.apiKey) { app = initializeApp(firebaseConfig); auth = getAuth(app); db = getFirestore(app); firebaseReady = true; console.log("Online Mode"); } } catch (e) { console.error(e); }
        let hiddenProducts = []; let storeSettings = { useAutoSchedule: true, isManualOpen: true, showHolidayNotice: false };
        const ENABLE_SCHEDULE_CHECK = true;
        const STORE_SCHEDULE = [ { day: 0, slots: [ { open: { h: 16, m: 30 }, close: { h: 23, m: 55 } } ] }, { day: 1, slots: [ { open: { h: 18, m: 0 }, close: { h: 23, m: 55 } } ] }, { day: 2, slots: [ { open: { h: 14, m: 0 }, close: { h: 23, m: 55 } } ] }, { day: 3, slots: [ { open: { h: 9, m: 0 }, close: { h: 12, m: 0 } }, { open: { h: 15, m: 0 }, close: { h: 23, m: 55 } } ] }, { day: 4, slots: [ { open: { h: 9, m: 0 }, close: { h: 12, m: 0 } }, { open: { h: 15, m: 0 }, close: { h: 23, m: 55 } } ] }, { day: 5, slots: [ { open: { h: 18, m: 0 }, close: { h: 22, m: 0 } } ] }, { day: 6, slots: [ { open: { h: 16, m: 30 }, close: { h: 23, m: 55 } } ] } ];
        const PHONE_NUMBER = '522452070033'; const SHIPPING_COST_VALUE = 15.00; const SHIPPING_THRESHOLD = 100.00;
        const ALL_FLAVORS = [ 'Habanero', 'Valentina', 'LimÃ³n con TajÃ­n', 'BBQ', 'BÃºfalo', 'Naturales', 'Ranch' ]; const SPECIAL_FLAVORS = [ 'Habanero', 'BBQ', 'BÃºfalo', 'Ranch' ];
        const NEW_YEAR_COUPONS = [
            { id: 'alitas-gratis-15', stock: 15, header: 'Â¡EL PREMIO MAYOR! ğŸ', offer: '1 Paquete de Alitas (8 pzs) Â¡TOTALMENTE GRATIS!', condition: 'Sin compra mÃ­nima. Â¡Solo para los mÃ¡s rÃ¡pidos!', codePrefix: 'ALITAS-2026' },
            { id: 'papas-gratis', stock: 100, header: 'Â¡EMPIEZA EL AÃ‘O CON EL PIE DERECHO! ğŸŸ', offer: 'LlÃ©vate 1 ORDEN DE PAPAS FRITAS Â¡GRATIS!', condition: 'En la compra de cualquier Paquete (Duo, Amigos, Familiar o LLenador).', codePrefix: 'PAPAS-2026' },
            { id: 'descuento-30', stock: 100, header: 'Â¡TU PRIMER REGALO DEL AÃ‘O! ğŸ’¸', offer: 'Recibe $30 DE DESCUENTO directo en el total de tu cuenta.', condition: 'VÃ¡lido Ãºnicamente en pedidos a partir de $250 pesos.', codePrefix: 'DESC30-2026' },
            { id: 'combo-celebrar', stock: 100, header: 'Â¡EL COMBO PERFECTO PARA CELEBRAR! ğŸ”¥', offer: 'LlÃ©vate el Paquete "Pa\' Compartir" (20 Pzas) + 2 Coca-Cola (600ml).', condition: 'Por un precio especial de $215 (Ahorras $10).', codePrefix: 'COMBO-2026' }
        ];
        const COUPONS = { 'DESCUENTO30': { type: 'discount', value: 30, minSubtotal: 250, description: '$30 DE DESCUENTO directo (con cupÃ³n fÃ­sico)', validUntil: '2025-11-28T23:59:59' }, 'PAPASGRATIS': { type: 'descriptive', value: null, requiredItems: [2, 3, 4, 5], description: 'Â¡1 ORDEN DE PAPAS FRITAS GRATIS! (con cupÃ³n fÃ­sico)', validUntil: '2025-11-23T23:59:59' }, 'JUEVESBONELESS': { type: 'descriptive', value: null, requiredItems: [17], requiredDays: [4], specificDates: ['2025-11-13', '2025-11-20', '2025-11-27'], description: 'Â¡Aplicar 50% DESCUENTO A 1 ORDEN DE BONELESS! (con cupÃ³n fÃ­sico)', validUntil: '2025-11-27T23:59:59' }, 'ALITASGRATIS': { type: 'descriptive', value: null, minSubtotal: 500, description: 'Â¡1 Kilo de Alitas GRATIS! (con cupÃ³n fÃ­sico)', validUntil: '2025-11-30T23:59:59' } };
        const ALL_PRODUCTS = [
            { id: 1, name: 'Paquete Personal (8 pzs)', price: 85.00, category: 'Paquetes', imageUrl: 'https://images.unsplash.com/photo-1567620832903-9fc6debc209f?q=80&w=400', placeholderText: 'Paquete', requiresFlavorSelection: true, maxFlavors: 2, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 2, name: 'Paquete DÃºo (14 pzs)', price: 135.00, category: 'Paquetes', imageUrl: 'https://images.unsplash.com/photo-1567620832903-9fc6debc209f?q=80&w=400', placeholderText: 'Paquete', requiresFlavorSelection: true, maxFlavors: 2, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 3, name: 'Paquete Amigos (25 pzs)', price: 235.00, category: 'Paquetes', imageUrl: 'https://images.unsplash.com/photo-1567620832903-9fc6debc209f?q=80&w=400', placeholderText: 'Paquete', requiresFlavorSelection: true, maxFlavors: 2, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 4, name: 'Paquete Familiar (35 pzs)', price: 275.00, category: 'Paquetes', imageUrl: 'https://images.unsplash.com/photo-1567620832903-9fc6debc209f?q=80&w=400', placeholderText: 'Paquete', requiresFlavorSelection: true, maxFlavors: 2, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 5, name: 'Paquete Llenador (50 pzs)', price: 450.00, category: 'Paquetes', imageUrl: 'https://images.unsplash.com/photo-1567620832903-9fc6debc209f?q=80&w=400', placeholderText: 'Paquete', requiresFlavorSelection: true, maxFlavors: 2, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 9, name: 'Orden Kids (4 pzs)', price: 35.00, category: 'Paquetes', imageUrl: 'https://images.unsplash.com/photo-1567620832903-9fc6debc209f?q=80&w=400', placeholderText: 'Kids', requiresFlavorSelection: true, maxFlavors: 1, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 22, name: "Paquete 'Pa' Compartir (20 Pzas)", price: 185.00, category: 'Paquetes', imageUrl: 'https://images.unsplash.com/photo-1567620832903-9fc6debc209f?q=80&w=400', placeholderText: 'Paquete', requiresFlavorSelection: true, maxFlavors: 2, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 23, name: "Paquete 'ReuniÃ³n' (40 Pzas)", price: 315.00, category: 'Paquetes', imageUrl: 'https://images.unsplash.com/photo-1567620832903-9fc6debc209f?q=80&w=400', placeholderText: 'Paquete', requiresFlavorSelection: true, maxFlavors: 2, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 24, name: "Paquete 'Mega Fiesta' (75 Pzas)", price: 650.00, category: 'Paquetes', imageUrl: 'https://images.unsplash.com/photo-1567620832903-9fc6debc209f?q=80&w=400', placeholderText: 'Paquete', requiresFlavorSelection: true, maxFlavors: 2, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 18, name: 'Combo Mixto ClÃ¡sico (6 boneless 6 alitas)', price: 115.00, category: 'Combos', imageUrl: 'https://images.unsplash.com/photo-1628481353981-80deba45e1a1?q=80&w=400', placeholderText: 'Combo', requiresFlavorSelection: true, maxFlavors: 2, flavors: SPECIAL_FLAVORS, isCustomQuantity: false }, { id: 19, name: 'Combo Diez de Diez (10 boneless 10 alitas)', price: 195.00, category: 'Combos', imageUrl: 'https://images.unsplash.com/photo-1628481353981-80deba45e1a1?q=80&w=400', placeholderText: 'Combo', requiresFlavorSelection: true, maxFlavors: 2, flavors: SPECIAL_FLAVORS, isCustomQuantity: false }, { id: 20, name: 'Combo DinÃ¡mico (5 boneless 5 alitas)', price: 100.00, category: 'Combos', imageUrl: 'https://images.unsplash.com/photo-1628481353981-80deba45e1a1?q=80&w=400', placeholderText: 'Combo', requiresFlavorSelection: true, maxFlavors: 2, flavors: SPECIAL_FLAVORS, isCustomQuantity: false }, { id: 25, name: 'Combo Combinado (15 Alitas y 10 boneless)', price: 250.00, category: 'Combos', imageUrl: 'https://images.unsplash.com/photo-1628481353981-80deba45e1a1?q=80&w=400', placeholderText: 'Combo', requiresFlavorSelection: true, maxFlavors: 2, flavors: SPECIAL_FLAVORS, isCustomQuantity: false }, { id: 6, name: '1 kg (18 pzs)', price: 190.00, category: 'Alitas', imageUrl: 'https://images.unsplash.com/photo-1567620832903-9fc6debc209f?q=80&w=400', placeholderText: 'Alitas', requiresFlavorSelection: true, maxFlavors: 7, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 7, name: '1/2 kg (10 pzs)', price: 95.00, category: 'Alitas', imageUrl: 'https://images.unsplash.com/photo-1567620832903-9fc6debc209f?q=80&w=400', placeholderText: 'Alitas', requiresFlavorSelection: true, maxFlavors: 7, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 8, name: 'Orden (6 pzs)', price: 65.00, category: 'Alitas', imageUrl: 'https://images.unsplash.com/photo-1567620832903-9fc6debc209f?q=80&w=400', placeholderText: 'Alitas', requiresFlavorSelection: true, maxFlavors: 1, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 17, name: 'Orden Boneless (10 pzs)', price: 95.00, category: 'Boneless', imageUrl: 'https://images.unsplash.com/photo-1626082896492-766af4ebc573?q=80&w=400', placeholderText: 'Boneless', requiresFlavorSelection: true, maxFlavors: 2, flavors: SPECIAL_FLAVORS, isCustomQuantity: false }, { id: 16, name: 'Boneless x Pieza', price: 10.00, category: 'Boneless', imageUrl: 'https://images.unsplash.com/photo-1626082896492-766af4ebc573?q=80&w=400', placeholderText: 'Boneless', requiresFlavorSelection: true, maxFlavors: 2, flavors: SPECIAL_FLAVORS, isCustomQuantity: true }, { id: 14, name: 'Lunes x Pieza', price: 6.50, category: 'Promociones', imageUrl: 'https://images.unsplash.com/photo-1598511757310-17e47b74f07e?q=80&w=400', placeholderText: 'Promo', requiresFlavorSelection: true, maxFlavors: 2, flavors: ALL_FLAVORS, isCustomQuantity: true }, { id: 15, name: 'Martes x Pieza', price: 7.50, category: 'Promociones', imageUrl: 'https://images.unsplash.com/photo-1598511757310-17e47b74f07e?q=80&w=400', placeholderText: 'Promo', requiresFlavorSelection: true, maxFlavors: 2, flavors: ALL_FLAVORS, isCustomQuantity: true }, { id: 21, name: 'MiÃ©rcoles y Jueves x Pieza', price: 7.50, category: 'Promociones', imageUrl: 'https://images.unsplash.com/photo-1598511757310-17e47b74f07e?q=80&w=400', placeholderText: 'Promo', requiresFlavorSelection: true, maxFlavors: 2, flavors: SPECIAL_FLAVORS, isCustomQuantity: true }, { id: 26, name: 'MIÃ‰RCOLES DE BONELESS (10 Boneless + Papas)', price: 130.00, category: 'Promociones', imageUrl: 'https://images.unsplash.com/photo-1598511757310-17e47b74f07e?q=80&w=400', placeholderText: 'Promo', requiresFlavorSelection: true, maxFlavors: 2, flavors: SPECIAL_FLAVORS, isCustomQuantity: false }, { id: 32, name: "Combo Listo (Pa' Compartir 20 Pzas + 2 Cocas)", price: 215.00, category: 'Promociones', imageUrl: 'https://images.unsplash.com/photo-1598511757310-17e47b74f07e?q=80&w=400', placeholderText: 'Promo', requiresFlavorSelection: true, maxFlavors: 2, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 27, name: 'Combo Personal Completo (8 Alitas + Papas + Coca)', price: 145.00, category: 'Paquetes Completos', imageUrl: 'https://images.unsplash.com/photo-1599974802164-58c6e30ab86e?q=80&w=400', placeholderText: 'Completo', requiresFlavorSelection: true, maxFlavors: 2, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 28, name: 'Combo Personal Completo (8 Boneless + Papas + Coca)', price: 145.00, category: 'Paquetes Completos', imageUrl: 'https://images.unsplash.com/photo-1599974802164-58c6e30ab86e?q=80&w=400', placeholderText: 'Completo', requiresFlavorSelection: true, maxFlavors: 2, flavors: SPECIAL_FLAVORS, isCustomQuantity: false }, { id: 29, name: 'Paquete Convivio (50 Alitas + 2 Papas + 2 Cocas)', price: 550.00, category: 'Paquetes Completos', imageUrl: 'https://images.unsplash.com/photo-1599974802164-58c6e30ab86e?q=80&w=400', placeholderText: 'Completo', requiresFlavorSelection: true, maxFlavors: 2, flavors: ALL_FLAVORS, isCustomQuantity: false }, { id: 30, name: 'Paquete Convivio (50 Boneless + 2 Papas + 2 Cocas)', price: 550.00, category: 'Paquetes Completos', imageUrl: 'https://images.unsplash.com/photo-1599974802164-58c6e30ab86e?q=80&w=400', placeholderText: 'Completo', requiresFlavorSelection: true, maxFlavors: 2, flavors: SPECIAL_FLAVORS, isCustomQuantity: false }, { id: 10, name: 'Orden de Papas Fritas', price: 45.00, category: 'Extras', imageUrl: 'https://images.unsplash.com/photo-1576107232684-1279f390859f?q=80&w=400', placeholderText: 'Papas', requiresFlavorSelection: false, flavors: [], isCustomQuantity: false }, { id: 11, name: 'Aderezo Ranch', price: 20.00, category: 'Extras', imageUrl: '', placeholderText: 'Aderezo', requiresFlavorSelection: false, flavors: [], isCustomQuantity: false }, { id: 31, name: 'Â¡Agranda tu Orden! (1 Papas + 1 Coca-Cola)', price: 60.00, category: 'Extras', imageUrl: 'https://images.unsplash.com/photo-1622873489814-a0f393691b0f?q=80&w=400', placeholderText: 'Extra', requiresFlavorSelection: false, flavors: [], isCustomQuantity: false }, { id: 12, name: 'Coca-Cola 600 ml', price: 30.00, category: 'Bebidas', imageUrl: 'https://images.unsplash.com/photo-1554866585-cd94860890b7?q=80&w=400', placeholderText: 'Coca-Cola', requiresFlavorSelection: false, flavors: [], isCustomQuantity: false }, { id: 13, name: 'Mundet 600 ml', price: 30.00, category: 'Bebidas', imageUrl: 'https://images.unsplash.com/photo-1610873167013-28495d6f2a68?q=80&w=400', placeholderText: 'Mundet', requiresFlavorSelection: false, flavors: [], isCustomQuantity: false }
        ];
        document.addEventListener('DOMContentLoaded', () => {
            const state = { cart: [], currentProduct: null, selectedFlavors: [], appliedCoupon: null };
            const dom = {
                introOverlay: document.getElementById('intro-overlay'), productList: document.getElementById('product-list'), categoryFilters: document.getElementById('category-filters'), searchBar: document.getElementById('search-bar'), storeClosedBanner: document.getElementById('store-closed-banner'), storeClosedMessage: document.getElementById('store-closed-message'), holidayNoticeBanner: document.getElementById('holiday-notice-banner'), cart: { list: document.getElementById('cart-list'), subtotal: document.getElementById('cart-subtotal'), shipping: document.getElementById('shipping-cost'), shippingPromo: document.getElementById('shipping-promo-desktop'), total: document.getElementById('cart-total'), emptyMsg: document.getElementById('empty-cart-message'), checkoutBtn: document.getElementById('checkout-button'), clearBtn: document.getElementById('clear-cart-button'), section: document.getElementById('cart-section'), couponSelect: document.getElementById('coupon-select-desktop'), couponMsg: document.getElementById('coupon-message-desktop'), discountRow: document.getElementById('discount-row-desktop'), discountAmount: document.getElementById('cart-discount-desktop') }, mobileCart: { view: document.getElementById('cart-mobile-view'), list: document.getElementById('cart-list-mobile'), subtotal: document.getElementById('cart-subtotal-mobile'), shipping: document.getElementById('shipping-cost-mobile'), shippingPromo: document.getElementById('shipping-promo-mobile'), total: document.getElementById('cart-total-mobile'), emptyMsg: document.getElementById('empty-cart-message-mobile'), checkoutBtn: document.getElementById('checkout-button-mobile'), openBtn: document.getElementById('mobile-cart-button'), closeBtn: document.getElementById('close-mobile-cart-button'), couponSelect: document.getElementById('coupon-select-mobile'), couponMsg: document.getElementById('coupon-message-mobile'), discountRow: document.getElementById('discount-row-mobile'), discountAmount: document.getElementById('cart-discount-mobile'), countBadge: document.getElementById('mobile-cart-count') }, orderModal: { modal: document.getElementById('order-modal'), form: document.getElementById('order-form'), closeBtn: document.getElementById('close-modal-button'), paymentSelect: document.getElementById('payment'), amountContainer: document.getElementById('amount-field-container'), amountInput: document.getElementById('amount'), cambioField: document.getElementById('cambio-field'), cambioTotal: document.getElementById('cambio-total'), paymentTotal: document.getElementById('payment-total-amount') }, flavorModal: { modal: document.getElementById('flavor-modal'), title: document.getElementById('flavor-modal-title'), maxCount: document.getElementById('flavors-max-count'), selectedCount: document.getElementById('flavors-selected-count'), options: document.getElementById('flavor-options'), confirmBtn: document.getElementById('confirm-flavors-button'), closeBtn: document.getElementById('close-flavor-modal-button') }, qtyFlavorModal: { modal: document.getElementById('quantity-flavor-modal'), title: document.getElementById('quantity-flavor-modal-title'), quantityInput: document.getElementById('quantity-input'), maxCount: document.getElementById('quantity-flavors-max-count'), selectedCount: document.getElementById('quantity-flavors-selected-count'), options: document.getElementById('quantity-flavor-options'), confirmBtn: document.getElementById('confirm-quantity-flavors-button'), closeBtn: document.getElementById('close-quantity-flavor-modal-button') }, extrasModal: { modal: document.getElementById('extras-modal'), listExtras: document.getElementById('extras-list'), listBebidas: document.getElementById('bebidas-list'), closeBtn: document.getElementById('close-extras-modal-button'), skipBtn: document.getElementById('skip-extras-modal-button') }, confirmationModal: { modal: document.getElementById('confirmation-modal'), closeBtn: document.getElementById('close-confirmation-button') }, admin: { loginBtn: document.getElementById('admin-login-btn'), loginModal: document.getElementById('admin-login-modal'), passwordInput: document.getElementById('admin-password'), submitLogin: document.getElementById('admin-submit-login'), cancelLogin: document.getElementById('admin-cancel-login'), panelModal: document.getElementById('admin-panel-modal'), closePanel: document.getElementById('admin-close-panel'), finishBtn: document.getElementById('admin-finish-btn'), productList: document.getElementById('admin-product-list'), toggleSchedule: document.getElementById('admin-toggle-schedule'), toggleManualOpen: document.getElementById('admin-toggle-manual-open'), manualStatusContainer: document.getElementById('admin-manual-status-container'), toggleHoliday: document.getElementById('admin-toggle-holiday'), testGiveawayBtn: document.getElementById('admin-test-giveaway') }, giveaway: { section: document.getElementById('giveaway-section'), countdownLabel: document.getElementById('countdown-label'), countdownTimer: document.getElementById('countdown-timer'), newYearMessage: document.getElementById('new-year-message'), grid: document.getElementById('giveaway-grid'), timerDisplay: document.getElementById('giveaway-timer'), modal: document.getElementById('claim-giveaway-modal'), form: document.getElementById('giveaway-form'), closeBtn: document.getElementById('close-giveaway-modal'), teaser: document.getElementById('giveaway-teaser'), offerText: document.getElementById('giveaway-offer-text'), couponIdInput: document.getElementById('giveaway-coupon-id'), couponOfferInput: document.getElementById('giveaway-coupon-offer') }
            };
            let productsToRender = []; let isStoreCurrentlyOpen = false; const ADMIN_PASSWORD = "admin123";
            let giveawayActive = false; let giveawayEndTime = null; 
            
            // Initial state for coupons
            let couponsData = {
                'alitas-gratis-15': { stock: 15 },
                'papas-gratis': { stock: 100 },
                'descuento-30': { stock: 100 },
                'combo-celebrar': { stock: 100 }
            };

            setTimeout(() => { if(dom.introOverlay) { dom.introOverlay.classList.add('fade-out'); setTimeout(() => { dom.introOverlay.remove(); }, 800); } }, 2000);

            // --- COUNTDOWN & GIVEAWAY LOGIC ---
            const updateCountdown = () => {
                const now = new Date();
                const nextYear = new Date('January 1, 2026 00:00:00');
                const diff = nextYear - now;

                if (diff <= 0 || giveawayActive) {
                    if (!giveawayActive) activateGiveaway();
                } else {
                    const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const s = Math.floor((diff % (1000 * 60)) / 1000);
                    if(document.getElementById('days')) document.getElementById('days').innerText = d < 10 ? '0' + d : d;
                    if(document.getElementById('hours')) document.getElementById('hours').innerText = h < 10 ? '0' + h : h;
                    if(document.getElementById('minutes')) document.getElementById('minutes').innerText = m < 10 ? '0' + m : m;
                    if(document.getElementById('seconds')) document.getElementById('seconds').innerText = s < 10 ? '0' + s : s;
                }
            };
            
            const renderGiveawayGrid = () => {
                if(!dom.giveaway.grid) return;
                
                const createCouponCard = (coupon) => {
                    const stock = couponsData[coupon.id].stock;
                    const stockPercent = (stock / 100) * 100;
                    const isSoldOut = stock <= 0;
                    
                    return `
                    <div class="bg-white/10 rounded-lg p-4 backdrop-blur-sm border border-white/20 flex flex-col justify-between h-full transform hover:scale-[1.02] transition-transform">
                        <div>
                            <div class="flex justify-between items-start mb-2">
                                <span class="bg-gold-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full uppercase shadow-sm">Limitado</span>
                                <span class="text-xs font-bold text-gold-300">${stock} disponibles</span>
                            </div>
                            <h4 class="font-extrabold text-lg text-white mb-1 leading-tight">${coupon.header}</h4>
                            <p class="text-sm font-bold text-gold-300 mb-1">${coupon.offer}</p>
                            <p class="text-[10px] text-red-100 mb-3 italic">${coupon.condition}</p>
                        </div>
                        <div>
                            <div class="w-full bg-red-900/40 rounded-full h-1.5 mb-3">
                                <div class="bg-gold-400 h-1.5 rounded-full transition-all duration-500" style="width: ${stockPercent}%"></div>
                            </div>
                            <button 
                                onclick="window.openClaimModal('${coupon.id}')"
                                class="w-full ${isSoldOut ? 'bg-gray-400 cursor-not-allowed' : 'bg-white hover:bg-gray-50 shimmer-btn'} text-red-600 font-bold py-2 rounded-lg text-sm shadow-md transition-colors"
                                ${isSoldOut ? 'disabled' : ''}
                            >
                                ${isSoldOut ? 'AGOTADO' : 'RECLAMAR'}
                            </button>
                        </div>
                    </div>
                    `;
                };
                
                dom.giveaway.grid.innerHTML = NEW_YEAR_COUPONS.map(createCouponCard).join('');
            };
            
            const renderTeaserGrid = () => {
                const container = document.getElementById('teaser-grid');
                if(!container) return;

                container.innerHTML = NEW_YEAR_COUPONS.map(coupon => `
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-200 relative overflow-hidden opacity-80 flex flex-col h-full justify-between">
                        <div class="absolute top-2 right-2 text-slate-400">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-700 text-sm mb-1 leading-tight">${coupon.header}</h4>
                            <p class="text-xs text-primary-600 font-bold mb-2">${coupon.offer}</p>
                            <p class="text-[10px] text-slate-400 italic mb-3">${coupon.condition}</p>
                        </div>
                        <button disabled class="w-full bg-slate-100 text-slate-400 font-bold py-2 rounded-lg text-xs cursor-not-allowed border border-slate-200">
                            ğŸ”’ Disponible en 2026
                        </button>
                    </div>
                `).join('');
            };

            const activateGiveaway = () => {
                if (giveawayActive) return;
                giveawayActive = true;
                if(dom.giveaway.countdownLabel) dom.giveaway.countdownLabel.classList.add('hidden');
                if(dom.giveaway.countdownTimer) dom.giveaway.countdownTimer.classList.add('hidden');
                if(dom.giveaway.teaser) dom.giveaway.teaser.classList.add('hidden'); 
                if(dom.giveaway.newYearMessage) dom.giveaway.newYearMessage.classList.remove('hidden');
                if(dom.giveaway.section) dom.giveaway.section.classList.remove('hidden');
                
                // Initialize coupons state from firebase if possible, otherwise use default
                // For now using local var couponsData
                renderGiveawayGrid();
                
                // Start 3 min timer
                giveawayEndTime = new Date().getTime() + 3 * 60 * 1000;
                updateGiveawayTimer();
                setInterval(updateGiveawayTimer, 1000);
            };
            
            // Expose function to window for HTML inline onclick
            window.openClaimModal = (couponId) => {
                if (!giveawayActive) return;
                const coupon = NEW_YEAR_COUPONS.find(c => c.id === couponId);
                if (!coupon) return;
                
                if (couponsData[couponId].stock <= 0) {
                    showToast("Â¡Lo sentimos! Este cupÃ³n se ha agotado.", "error");
                    return;
                }
                
                // Populate Modal
                if(dom.giveaway.offerText) dom.giveaway.offerText.innerHTML = `Ingresa tus datos para generar tu cupÃ³n de: <br><strong>${coupon.offer}</strong>`;
                if(dom.giveaway.couponIdInput) dom.giveaway.couponIdInput.value = couponId;
                if(dom.giveaway.couponOfferInput) dom.giveaway.couponOfferInput.value = coupon.offer;
                
                if(dom.giveaway.modal) dom.giveaway.modal.classList.remove('hidden');
            };

            const updateGiveawayTimer = () => {
                if (!giveawayActive) return;
                const now = new Date().getTime();
                const distance = giveawayEndTime - now;
                
                if (distance < 0) {
                    if(dom.giveaway.section) dom.giveaway.section.classList.add('hidden');
                    if(dom.giveaway.newYearMessage) dom.giveaway.newYearMessage.innerHTML = '<span class="text-xl font-bold text-slate-500">La promociÃ³n ha finalizado. Â¡Feliz 2026!</span>';
                    giveawayActive = false;
                    return;
                }

                const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((distance % (1000 * 60)) / 1000);
                if(dom.giveaway.timerDisplay) dom.giveaway.timerDisplay.innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
            };

            const handleClaimGiveaway = (e) => {
                e.preventDefault();
                
                const formData = new FormData(dom.giveaway.form);
                const winnerData = Object.fromEntries(formData.entries());
                const couponId = winnerData.coupon_id;
                
                if (couponsData[couponId].stock <= 0) { 
                    showToast("Â¡Lo sentimos! Se acabaron los cupones.", "error"); 
                    return; 
                }
                
                // Decrement stock
                couponsData[couponId].stock--;
                renderGiveawayGrid(); // Re-render to update stock UI

                // Find coupon details
                const couponInfo = NEW_YEAR_COUPONS.find(c => c.id === couponId);
                const uniqueCode = `${couponInfo.codePrefix}-${100 - couponsData[couponId].stock}`;

                // Send to WhatsApp
                let message = `ğŸ Â¡QUIERO RECLAMAR MI REGALO DE AÃ‘O NUEVO! ğŸ\n\n` +
                              `*CupÃ³n*: ${couponInfo.offer}\n` +
                              `*CÃ³digo Ãšnico*: ${uniqueCode}\n\n` +
                              `*Mis Datos:*\n` +
                              `Nombre: ${winnerData.winner_name}\n` +
                              `DirecciÃ³n: ${winnerData.winner_address}\n` +
                              `Detalles: ${winnerData.winner_details || 'N/A'}`;
                
                window.open(`https://wa.me/${PHONE_NUMBER}?text=${encodeURIComponent(message)}`, '_blank');
                
                if(dom.giveaway.modal) dom.giveaway.modal.classList.add('hidden');
                
                showToast("Â¡Genial! EnvÃ­a el mensaje para validar tu premio.");
            };

            setInterval(updateCountdown, 1000);
            updateCountdown(); 
            
            // Render Teaser immediately
            renderTeaserGrid();

            // Initialize App
            const initAuth = async () => { if (!firebaseReady) return; try { const isManualConfig = firebaseConfig.apiKey && firebaseConfig.apiKey !== ""; if (!isManualConfig && typeof __initial_auth_token !== 'undefined' && __initial_auth_token) { await signInWithCustomToken(auth, __initial_auth_token); } else { await signInAnonymously(auth); } } catch (e) { console.error("Auth error:", e); try { await signInAnonymously(auth); } catch(ee) {} } };
            const subscribeToSettings = () => { if (!firebaseReady) { try { const savedHidden = JSON.parse(localStorage.getItem('wingsHouseHiddenProducts')); if (savedHidden) hiddenProducts = savedHidden; const savedSettings = JSON.parse(localStorage.getItem('wingsHouseSettings')); if (savedSettings) storeSettings = savedSettings; refreshViews(); } catch(e) {} return; } const settingsDoc = doc(db, 'artifacts', appId, 'public', 'data', 'store_settings', 'availability'); onSnapshot(settingsDoc, (docSnap) => { if (docSnap.exists()) { const data = docSnap.data(); hiddenProducts = data.hiddenIds || []; storeSettings.useAutoSchedule = data.useAutoSchedule !== undefined ? data.useAutoSchedule : true; storeSettings.isManualOpen = data.isManualOpen !== undefined ? data.isManualOpen : true; storeSettings.showHolidayNotice = data.showHolidayNotice !== undefined ? data.showHolidayNotice : false; } else { hiddenProducts = []; } refreshViews(); }, (error) => { console.error("Error syncing settings:", error); }); };
            const refreshViews = () => { if (dom.admin.toggleSchedule) dom.admin.toggleSchedule.checked = storeSettings.useAutoSchedule; if (dom.admin.toggleManualOpen) dom.admin.toggleManualOpen.checked = storeSettings.isManualOpen; if (dom.admin.toggleHoliday) dom.admin.toggleHoliday.checked = storeSettings.showHolidayNotice; updateAdminManualControlsUI(); const { isOpen } = checkStoreHours(); toggleOrdering(isOpen); if (storeSettings.showHolidayNotice) { if(dom.holidayNoticeBanner) dom.holidayNoticeBanner.classList.remove('hidden'); } else { if(dom.holidayNoticeBanner) dom.holidayNoticeBanner.classList.add('hidden'); } productsToRender = getAvailableProducts(); renderCategoryFilters(); filterAndRenderProducts(); renderExtrasModal(); if (!dom.admin.panelModal.classList.contains('hidden')) renderAdminProductList(); };
            const updateAdminManualControlsUI = () => { if (!dom.admin.manualStatusContainer) return; if (storeSettings.useAutoSchedule) { dom.admin.manualStatusContainer.classList.add('opacity-50', 'pointer-events-none'); } else { dom.admin.manualStatusContainer.classList.remove('opacity-50', 'pointer-events-none'); } };
            const saveStoreSettings = async () => { if (!firebaseReady) { localStorage.setItem('wingsHouseHiddenProducts', JSON.stringify(hiddenProducts)); localStorage.setItem('wingsHouseSettings', JSON.stringify(storeSettings)); refreshViews(); return; } try { const settingsDoc = doc(db, 'artifacts', appId, 'public', 'data', 'store_settings', 'availability'); await setDoc(settingsDoc, { hiddenIds: hiddenProducts, useAutoSchedule: storeSettings.useAutoSchedule, isManualOpen: storeSettings.isManualOpen, showHolidayNotice: storeSettings.showHolidayNotice }, { merge: true }); } catch (e) { console.error("Error saving settings:", e); showToast("Error al guardar cambios.", "error"); } };
            const toggleProductVisibility = async (id) => { if (hiddenProducts.includes(id)) { hiddenProducts = hiddenProducts.filter(h => h !== id); } else { hiddenProducts.push(id); } if (dom.admin.panelModal.classList.contains('hidden') === false) renderAdminProductList(); await saveStoreSettings(); };
            const renderAdminProductList = () => { dom.admin.productList.innerHTML = ALL_PRODUCTS.map(product => { const isHidden = hiddenProducts.includes(product.id); const activeClass = !isHidden ? 'border-green-500 ring-1 ring-green-500 bg-green-50' : 'border-gray-200 bg-white'; const textClass = !isHidden ? 'text-green-800' : 'text-slate-600'; return `<div class="flex items-center justify-between p-4 border rounded-xl transition-all duration-200 ${activeClass} hover:shadow-md"><div class="flex-1 pr-4"><p class="font-bold ${textClass} text-lg">${product.name}</p><p class="text-xs text-slate-500 uppercase tracking-wide font-semibold mt-1">${product.category}</p></div><div class="relative inline-block w-14 align-middle select-none shrink-0"><input type="checkbox" name="toggle" id="toggle-${product.id}" class="toggle-checkbox absolute block w-7 h-7 rounded-full bg-white border-4 appearance-none cursor-pointer border-gray-300 transition-all duration-300" ${!isHidden ? 'checked' : ''} onchange="window.handleAdminToggle(${product.id})"/><label for="toggle-${product.id}" class="toggle-label block overflow-hidden h-7 rounded-full bg-gray-300 cursor-pointer transition-colors duration-300"></label></div></div>`; }).join(''); };
            window.handleAdminToggle = (id) => { toggleProductVisibility(id); };
            const checkStoreHours = () => { if (!storeSettings.useAutoSchedule) { if (storeSettings.isManualOpen) return { isOpen: true, message: '' }; else return { isOpen: false, message: 'La tienda estÃ¡ cerrada temporalmente por el administrador.' }; } if (!ENABLE_SCHEDULE_CHECK) return { isOpen: true, message: '' }; try { const now = new Date(); const today = now.getDay(); const currentHour = now.getHours(); const currentMinute = now.getMinutes(); const currentTimeInMinutes = currentHour * 60 + currentMinute; const schedule = STORE_SCHEDULE.find(s => s.day === today); if (!schedule || !schedule.slots || schedule.slots.length === 0) return { isOpen: false, message: 'Hoy estamos cerrados. Â¡Te esperamos maÃ±ana!' }; const formatTime = (time) => new Date(0,0,0, time.h, time.m).toLocaleTimeString('es-MX', { hour: 'numeric', minute: 'numeric', hour12: true }); const scheduleString = schedule.slots.map(slot => `de ${formatTime(slot.open)} a ${formatTime(slot.close)}`).join(' y '); for (const slot of schedule.slots) { const { open, close } = slot; const openTimeInMinutes = open.h * 60 + open.m; let closeTimeInMinutes = close.h * 60 + close.m; if (closeTimeInMinutes < openTimeInMinutes) { if (close.h === 0 && close.m === 0) closeTimeInMinutes = 24 * 60; } if (currentTimeInMinutes >= openTimeInMinutes && currentTimeInMinutes < closeTimeInMinutes) return { isOpen: true, message: '' }; } return { isOpen: false, message: `Estamos cerrados. ${`Nuestro horario de hoy es ${scheduleString}.`}` }; } catch (e) { console.error("Error al verificar horario:", e); return { isOpen: true, message: '' }; } };
            const toggleOrdering = (enable) => { isStoreCurrentlyOpen = enable; dom.cart.checkoutBtn.disabled = !enable || state.cart.length === 0; dom.mobileCart.checkoutBtn.disabled = !enable || state.cart.length === 0; dom.productList.querySelectorAll('.add-to-cart-btn').forEach(btn => { btn.disabled = !enable; btn.textContent = !enable ? 'Cerrado' : 'AÃ±adir'; }); if (enable) { dom.storeClosedBanner.classList.add('hidden'); } else { const { message } = checkStoreHours(); dom.storeClosedMessage.textContent = message; dom.storeClosedBanner.classList.remove('hidden'); } };
            const saveState = () => { try { localStorage.setItem('wingsHouseCart', JSON.stringify(state.cart)); localStorage.setItem('wingsHouseCoupon', JSON.stringify(state.appliedCoupon)); } catch (e) { console.error("Error al guardar en LocalStorage:", e); } };
            const loadState = () => { try { const savedCart = localStorage.getItem('wingsHouseCart'); const savedCoupon = localStorage.getItem('wingsHouseCoupon'); const savedUser = localStorage.getItem('wingsHouseUser'); if (savedCart) state.cart = JSON.parse(savedCart); if (savedCoupon) state.appliedCoupon = JSON.parse(savedCoupon); if (savedUser) { const userData = JSON.parse(savedUser); if (dom.orderModal.form.name) dom.orderModal.form.name.value = userData.name || ''; if (dom.orderModal.form.address) dom.orderModal.form.address.value = userData.address || ''; if (dom.orderModal.form.details) dom.orderModal.form.details.value = userData.details || ''; } } catch (e) { console.error("Error al cargar desde LocalStorage:", e); state.cart = []; state.appliedCoupon = null; } };
            const saveUserData = (data) => { try { const userData = { name: data.name, address: data.address, details: data.details }; localStorage.setItem('wingsHouseUser', JSON.stringify(userData)); } catch (e) { console.error("Error saving user data", e); } };
            const getAvailableProducts = () => { const now = new Date(); const today = now.getDay(); return ALL_PRODUCTS.filter(product => { if (hiddenProducts.includes(product.id)) return false; switch(product.id) { case 14: return today === 1; case 15: return today === 2; case 21: return today === 3 || today === 4; case 26: return today === 3; case 32: return new Date() <= new Date('2025-11-23T23:59:59'); default: return true; } }); };
            const formatCurrency = (amount) => amount.toLocaleString('es-MX', { style: 'currency', currency: 'MXN' });
            const renderCategoryFilters = () => { const categories = ['Todos', ...new Set(productsToRender.map(p => p.category))]; const urlParams = new URLSearchParams(window.location.search); let initialCategory = urlParams.get('category') || 'Todos'; if (!categories.includes(initialCategory)) initialCategory = 'Todos'; dom.categoryFilters.innerHTML = categories.map((category) => `<button class="category-filter-btn ${category === initialCategory ? 'active' : ''}" data-category="${category}">${category}</button>`).join(''); return initialCategory; };
            const filterAndRenderProducts = () => { const activeCategoryBtn = dom.categoryFilters.querySelector('.category-filter-btn.active'); const category = activeCategoryBtn ? activeCategoryBtn.dataset.category : 'Todos'; const searchTerm = dom.searchBar.value.toLowerCase().trim(); let filteredProducts = productsToRender; if (category !== 'Todos') filteredProducts = filteredProducts.filter(p => p.category === category); if (searchTerm) filteredProducts = filteredProducts.filter(p => p.name.toLowerCase().includes(searchTerm)); dom.productList.innerHTML = ''; if (filteredProducts.length === 0) { dom.productList.innerHTML = `<p class="text-slate-500 col-span-full text-center">No se encontraron productos.</p>`; return; } filteredProducts.forEach(product => { const productCard = document.createElement('div'); productCard.className = 'bg-white rounded-2xl shadow-lg overflow-hidden flex flex-col transform transition-all duration-300 hover:shadow-2xl cursor-pointer group'; productCard.dataset.id = product.id; productCard.innerHTML = `<div class="aspect-[4/3] overflow-hidden"><img src="${product.imageUrl}&auto=format&fit=crop&w=400" alt="${product.name}" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/400x300/f59e0b/white?text=${product.placeholderText}';"></div><div class="p-4 flex flex-col flex-grow"><h3 class="text-lg font-bold text-slate-800 mb-1 flex-grow min-h-[2.5em]">${product.name}</h3><div class="flex justify-between items-center mt-3"><p class="text-xl font-bold text-primary-700">${formatCurrency(product.price)}</p><button data-id="${product.id}" class="add-to-cart-btn mt-auto bg-primary-600 text-white font-bold py-2 px-4 rounded-full hover:bg-primary-700 transition-all duration-300 shadow-md text-sm group-hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50" ${!isStoreCurrentlyOpen ? 'disabled' : ''}>${!isStoreCurrentlyOpen ? 'Cerrado' : 'AÃ±adir'}</button></div></div>`; dom.productList.appendChild(productCard); }); };
            
            // Safeguarded Render Function
            const renderExtrasModal = () => { 
                 const extras = ALL_PRODUCTS.filter(p => p.category === 'Extras' && !hiddenProducts.includes(p.id)); 
                 const bebidas = ALL_PRODUCTS.filter(p => p.category === 'Bebidas' && !hiddenProducts.includes(p.id)); 
                 
                 const createItemHTML = (product) => `<div class="flex justify-between items-center bg-slate-50 p-3 rounded-lg"><div><span class="font-semibold text-slate-800">${product.name}</span><span class="text-slate-600 ml-2">${formatCurrency(product.price)}</span></div><button data-id="${product.id}" class="add-extra-btn bg-primary-600 text-white font-bold py-1 px-3 rounded-full hover:bg-primary-700 transition-colors text-sm" ${!isStoreCurrentlyOpen ? 'disabled' : ''}>${!isStoreCurrentlyOpen ? 'Cerrado' : 'AÃ±adir'}</button></div>`; 
                 
                 if(dom.extrasModal.listExtras) dom.extrasModal.listExtras.innerHTML = extras.map(createItemHTML).join(''); 
                 if(dom.extrasModal.listBebidas) dom.extrasModal.listBebidas.innerHTML = bebidas.map(createItemHTML).join(''); 
            };

            const renderList = (listEl, emptyMsgEl) => { if (!listEl || !emptyMsgEl) return; listEl.innerHTML = ''; if (state.cart.length === 0) { emptyMsgEl.classList.remove('hidden'); } else { emptyMsgEl.classList.add('hidden'); state.cart.forEach((item, index) => { const flavorsText = item.flavors && item.flavors.length > 0 ? `<p class="text-xs text-slate-500 mt-1">Sabores: ${item.flavors.join(', ')}</p>` : ''; const cartItem = document.createElement('div'); cartItem.className = 'flex justify-between items-center p-3 border-b border-slate-100'; cartItem.innerHTML = `<div class="flex-1 min-w-0"><div class="flex items-center"><span class="font-bold text-slate-800">${item.name}</span></div>${flavorsText}<p class="text-primary-700 font-semibold text-sm mt-1">${formatCurrency(item.price * item.quantity)}</p></div><div class="flex items-center space-x-2 ml-4"><button data-index="${index}" class="decrease-qty-btn quantity-btn" aria-label="Disminuir cantidad" ${!isStoreCurrentlyOpen ? 'disabled' : ''}>-</button><span class="font-bold text-slate-800 w-5 text-center" aria-live="polite">${item.quantity}</span><button data-index="${index}" class="increase-qty-btn quantity-btn" aria-label="Aumentar cantidad" ${!isStoreCurrentlyOpen ? 'disabled' : ''}>+</button><button data-index="${index}" class="remove-from-cart-btn text-red-500 hover:text-red-700 ml-2" ${!isStoreCurrentlyOpen ? 'disabled' : ''}><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12.54 0c-.342.052-.682.107-1.022.166m11.022 0L12 5.25m-8.34 0L12 5.25m-3.75 0a48.108 48.108 0 013.478-.397m7.084 0a48.108 48.108 0 003.478-.397m-7.084 0L12 5.25" /></svg></button></div>`; listEl.appendChild(cartItem); }); } };
            const renderCart = () => { renderList(dom.cart.list, dom.cart.emptyMsg); renderList(dom.mobileCart.list, dom.mobileCart.emptyMsg); updateCartTotals(); const isCartEmpty = state.cart.length === 0; dom.cart.checkoutBtn.disabled = isCartEmpty || !isStoreCurrentlyOpen; dom.mobileCart.checkoutBtn.disabled = isCartEmpty || !isStoreCurrentlyOpen; dom.cart.clearBtn.classList.toggle('hidden', isCartEmpty); const totalItems = state.cart.reduce((sum, item) => sum + item.quantity, 0); if (totalItems > 0) { dom.mobileCart.countBadge.textContent = totalItems; dom.mobileCart.countBadge.classList.remove('hidden'); } else { dom.mobileCart.countBadge.classList.add('hidden'); } if (state.appliedCoupon) { const tagHTML = `<span class="coupon-applied-tag text-sm font-semibold px-3 py-1 border rounded-full flex items-center">${state.appliedCoupon.code}<button id="remove-coupon-btn" class="ml-2 text-green-800 hover:text-red-600 font-bold" ${!isStoreCurrentlyOpen ? 'disabled' : ''}>&times;</button></span>`; dom.cart.couponMsg.innerHTML = tagHTML; dom.mobileCart.couponMsg.innerHTML = tagHTML; dom.cart.couponSelect.disabled = true; dom.mobileCart.couponSelect.disabled = true; } else { dom.cart.couponMsg.innerHTML = ''; dom.mobileCart.couponMsg.innerHTML = ''; dom.cart.couponSelect.disabled = !isStoreCurrentlyOpen; dom.mobileCart.couponSelect.disabled = !isStoreCurrentlyOpen; dom.cart.couponSelect.value = ''; dom.mobileCart.couponSelect.value = ''; } };
            
            // Safeguarded Update Cart Totals
            const updateCartTotals = () => { 
                const subtotal = state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0); 
                const shippingCost = (subtotal > 0 && subtotal < SHIPPING_THRESHOLD) ? SHIPPING_COST_VALUE : 0; 
                let discount = 0; 
                if (state.appliedCoupon && state.appliedCoupon.type === 'discount') discount = state.appliedCoupon.value; 
                const total = subtotal + shippingCost - discount; 
                
                const updatePromoMessage = (el) => { 
                    if(!el) return;
                    if (subtotal > 0 && subtotal < SHIPPING_THRESHOLD) { const diff = SHIPPING_THRESHOLD - subtotal; el.textContent = `Â¡AÃ±ade ${formatCurrency(diff)} mÃ¡s para envÃ­o GRATIS!`; el.classList.remove('hidden'); } else { el.textContent = ''; el.classList.add('hidden'); } 
                }; 
                
                if(dom.cart.subtotal) dom.cart.subtotal.textContent = formatCurrency(subtotal); 
                if(dom.cart.shipping) {
                    dom.cart.shipping.textContent = shippingCost > 0 ? formatCurrency(shippingCost) : 'Â¡GRATIS!'; 
                    dom.cart.shipping.className = `font-semibold ${shippingCost > 0 ? 'text-red-500' : (subtotal > 0 ? 'text-green-500' : 'text-slate-600')}`; 
                }
                updatePromoMessage(dom.cart.shippingPromo); 
                
                if (discount > 0) { 
                    if(dom.cart.discountAmount) dom.cart.discountAmount.textContent = `- ${formatCurrency(discount)}`; 
                    if(dom.cart.discountRow) dom.cart.discountRow.classList.remove('hidden'); 
                } else { 
                    if(dom.cart.discountRow) dom.cart.discountRow.classList.add('hidden'); 
                } 
                if(dom.cart.total) dom.cart.total.textContent = formatCurrency(total); 

                // Mobile Cart
                if(dom.mobileCart.subtotal) dom.mobileCart.subtotal.textContent = formatCurrency(subtotal); 
                if(dom.mobileCart.shipping) {
                    dom.mobileCart.shipping.textContent = shippingCost > 0 ? formatCurrency(shippingCost) : 'Â¡GRATIS!'; 
                    dom.mobileCart.shipping.className = `font-semibold ${shippingCost > 0 ? 'text-red-500' : (subtotal > 0 ? 'text-green-500' : 'text-slate-600')}`; 
                }
                updatePromoMessage(dom.mobileCart.shippingPromo); 
                
                if (discount > 0) { 
                    if(dom.mobileCart.discountAmount) dom.mobileCart.discountAmount.textContent = `- ${formatCurrency(discount)}`; 
                    if(dom.mobileCart.discountRow) dom.mobileCart.discountRow.classList.remove('hidden'); 
                } else { 
                    if(dom.mobileCart.discountRow) dom.mobileCart.discountRow.classList.add('hidden'); 
                } 
                if(dom.mobileCart.total) dom.mobileCart.total.textContent = formatCurrency(total); 
                
                if (dom.orderModal.modal && !dom.orderModal.modal.classList.contains('hidden')) { 
                    if(dom.orderModal.paymentTotal) dom.orderModal.paymentTotal.textContent = formatCurrency(total); 
                    updateCambio(total); 
                } 
            };
            
            const updateCambio = (total) => { if (total === undefined) { const subtotal = state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0); const shippingCost = (subtotal > 0 && subtotal < SHIPPING_THRESHOLD) ? SHIPPING_COST_VALUE : 0; let discount = 0; if (state.appliedCoupon && state.appliedCoupon.type === 'discount') discount = state.appliedCoupon.value; total = subtotal + shippingCost - discount; } const amount = parseFloat(dom.orderModal.amountInput.value); const isCashPayment = ['Con Cambio', 'Efectivo'].includes(dom.orderModal.paymentSelect.value); if (isCashPayment && !isNaN(amount) && amount >= total) { const cambio = amount - total; dom.orderModal.cambioTotal.textContent = formatCurrency(cambio); dom.orderModal.cambioField.classList.remove('hidden'); } else { dom.orderModal.cambioField.classList.add('hidden'); } };
            const showToast = (message, type = 'success') => { const container = document.getElementById('toast-container'); const toast = document.createElement('div'); toast.className = 'toast'; const icon = type === 'success' ? 'âœ…' : 'âš ï¸'; toast.innerHTML = `<span class="toast-icon">${icon}</span><span>${message}</span>`; container.appendChild(toast); requestAnimationFrame(() => { toast.classList.add('show'); }); setTimeout(() => { toast.classList.remove('show'); setTimeout(() => { toast.remove(); }, 300); }, 3000); };
            const addToCart = (product, quantity = 1, flavors = [], bypassExtrasCheck = false) => { const wasCartEmpty = state.cart.length === 0; const existingItem = state.cart.find(item => item.id === product.id && JSON.stringify(item.flavors) === JSON.stringify(flavors)); if (existingItem) { existingItem.quantity += quantity; } else { state.cart.push({ ...product, quantity, flavors }); } renderCart(); const triggerCategories = ['Paquetes', 'Combos', 'Promociones', 'Alitas', 'Boneless']; if (triggerCategories.includes(product.category) && !bypassExtrasCheck) { dom.extrasModal.modal.querySelectorAll('.add-extra-btn').forEach(btn => { btn.disabled = false; btn.textContent = 'AÃ±adir'; if (!isStoreCurrentlyOpen) { btn.disabled = true; btn.textContent = 'Cerrado'; } }); dom.extrasModal.modal.classList.remove('hidden'); } if (wasCartEmpty && !bypassExtrasCheck) { dom.cart.section.classList.add('highlight-cart'); dom.mobileCart.openBtn.classList.add('highlight-cart-mobile'); setTimeout(() => { dom.cart.section.classList.remove('highlight-cart'); dom.mobileCart.openBtn.classList.remove('highlight-cart-mobile'); }, 4000); } saveState(); };
            const removeFromCart = (index) => { state.cart.splice(index, 1); renderCart(); saveState(); };
            const increaseCartItemQuantity = (index) => { if (state.cart[index]) { state.cart[index].quantity++; renderCart(); saveState(); } };
            const decreaseCartItemQuantity = (index) => { if (state.cart[index]) { if (state.cart[index].quantity > 1) { state.cart[index].quantity--; renderCart(); saveState(); } else { removeFromCart(index); } } };
            const clearCart = () => { state.cart = []; state.appliedCoupon = null; renderCart(); saveState(); };
            const openFlavorModal = (product) => { state.currentProduct = product; state.selectedFlavors = []; const isQtyModal = product.isCustomQuantity; const modal = isQtyModal ? dom.qtyFlavorModal : dom.flavorModal; modal.modal.classList.remove('hidden'); modal.title.textContent = `AÃ±adir "${product.name}"`; modal.maxCount.textContent = product.maxFlavors; modal.selectedCount.textContent = '0'; modal.options.innerHTML = ''; if (isQtyModal) modal.quantityInput.value = 1; if (product.flavors && Array.isArray(product.flavors)) { product.flavors.forEach(flavor => { const btn = document.createElement('button'); btn.type = 'button'; btn.className = 'flavor-button bg-slate-200 text-slate-700 font-semibold py-3 px-4 rounded-full transition-colors duration-200 hover:bg-slate-300'; btn.textContent = flavor; btn.dataset.flavor = flavor; modal.options.appendChild(btn); }); } modal.confirmBtn.disabled = true; };
            const handleFlavorSelection = (e, modalElements) => { if (!e.target.matches('.flavor-button')) return; const flavor = e.target.dataset.flavor; const maxFlavors = state.currentProduct.maxFlavors; const isSelected = state.selectedFlavors.includes(flavor); if (maxFlavors === 1) { state.selectedFlavors = isSelected ? [] : [flavor]; } else { if (isSelected) { state.selectedFlavors = state.selectedFlavors.filter(f => f !== flavor); } else if (state.selectedFlavors.length < maxFlavors) { state.selectedFlavors.push(flavor); } } modalElements.options.querySelectorAll('.flavor-button').forEach(btn => { const f = btn.dataset.flavor; const active = state.selectedFlavors.includes(f); btn.classList.toggle('bg-primary-600', active); btn.classList.toggle('text-white', active); btn.classList.toggle('bg-slate-200', !active); btn.classList.toggle('text-slate-700', !active); btn.disabled = state.selectedFlavors.length >= maxFlavors && !state.selectedFlavors.includes(f); }); modalElements.selectedCount.textContent = state.selectedFlavors.length; modalElements.confirmBtn.disabled = state.selectedFlavors.length === 0; };
            const closeAllModals = () => { dom.flavorModal.modal.classList.add('hidden'); dom.qtyFlavorModal.modal.classList.add('hidden'); dom.orderModal.modal.classList.add('hidden'); dom.confirmationModal.modal.classList.add('hidden'); dom.extrasModal.modal.classList.add('hidden'); dom.admin.loginModal.classList.add('hidden'); dom.admin.panelModal.classList.add('hidden'); dom.giveaway.modal.classList.add('hidden'); };
            const showOrderModal = () => { updateCartTotals(); dom.orderModal.paymentSelect.dispatchEvent(new Event('change')); dom.orderModal.modal.classList.remove('hidden'); dom.mobileCart.view.classList.remove('active'); };
            const sendOrderToWhatsApp = (orderDetails) => { let message = `Â¡Hola! ğŸ‘‹ Tengo un nuevo pedido:\n\n` + `*Cliente*: ${orderDetails.customer.name}\n` + `*DirecciÃ³n*: ${orderDetails.customer.address}\n` + (orderDetails.customer.details ? `*CaracterÃ­sticas*: ${orderDetails.customer.details}\n` : '') + `\n*Forma de pago*: ${orderDetails.customer.payment}` + ((orderDetails.customer.payment === 'Efectivo' || orderDetails.customer.payment === 'Con Cambio') && orderDetails.customer.amount ? ` (paga con: ${formatCurrency(parseFloat(orderDetails.customer.amount))})` : '') + (orderDetails.cambio > 0 ? `\n*Cambio*: ${formatCurrency(orderDetails.cambio)}` : '') + `\n\n*Productos*:\n` + orderDetails.items.map(item => `- ${item.quantity}x ${item.name}` + (item.flavors && item.flavors.length > 0 ? ` (Sabores: ${item.flavors.join(', ')})` : '') + ` (${formatCurrency(item.price)} c/u)`).join('\n') + `\n\n*Subtotal*: ${formatCurrency(orderDetails.subtotal)}\n` + `*Costo de envÃ­o*: ${orderDetails.shippingCost > 0 ? formatCurrency(orderDetails.shippingCost) : 'Â¡GRATIS!'}\n`; if (orderDetails.coupon) { if(orderDetails.coupon.type === 'discount') message += `*Descuento*: -${formatCurrency(orderDetails.coupon.value)}\n`; message += `*CupÃ³n Aplicado*: ${orderDetails.coupon.description}\n`; } message += `*Total*: ${formatCurrency(orderDetails.total)}`; window.open(`https://wa.me/${PHONE_NUMBER}?text=${encodeURIComponent(message)}`, '_blank'); };
            const applyCoupon = (code) => { if (!code) { removeCoupon(); return; } const coupon = COUPONS[code]; const subtotal = state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0); const now = new Date(); const today = now.getDay(); const todayDateString = now.toISOString().split('T')[0]; const showMessage = (msg, isError) => { const classList = isError ? 'coupon-error-msg' : 'text-green-600'; dom.cart.couponMsg.innerHTML = `<span class="${classList}">${msg}</span>`; dom.mobileCart.couponMsg.innerHTML = `<span class="${classList}">${msg}</span>`; }; if (!coupon) { showMessage('El cupÃ³n no es vÃ¡lido.', true); return; } if (coupon.validUntil && now > new Date(coupon.validUntil)) { showMessage('Este cupÃ³n ha expirado.', true); return; } if (coupon.minSubtotal && subtotal < coupon.minSubtotal) { showMessage(`Este cupÃ³n requiere una compra mÃ­nima de ${formatCurrency(coupon.minSubtotal)}.`, true); return; } if (coupon.requiredItems && !state.cart.some(item => coupon.requiredItems.includes(item.id))) { showMessage('Este cupÃ³n no aplica para los productos en tu carrito.', true); return; } if (coupon.requiredDays && !coupon.requiredDays.includes(today)) { showMessage('Este cupÃ³n no es vÃ¡lido hoy.', true); return; } if (coupon.specificDates && !coupon.specificDates.includes(todayDateString)) { showMessage('Este cupÃ³n no es vÃ¡lido hoy.', true); return; } state.appliedCoupon = { ...coupon, code }; renderCart(); saveState(); };
            const removeCoupon = () => { state.appliedCoupon = null; renderCart(); saveState(); };
            const handleCategoryFilterClick = (e) => { if (e.target.matches('.category-filter-btn')) { document.querySelectorAll('.category-filter-btn').forEach(btn => btn.classList.remove('active')); e.target.classList.add('active'); const category = e.target.dataset.category; const url = new URL(window.location); if (category === 'Todos') url.searchParams.delete('category'); else url.searchParams.set('category', category); window.history.replaceState(null, '', url); filterAndRenderProducts(); } };
            const handleProductListClick = (e) => { const card = e.target.closest('.cursor-pointer[data-id]'); if (!card) return; const productId = parseInt(card.dataset.id); const product = productsToRender.find(p => p.id === productId); if (!product) return; dom.mobileCart.view.classList.remove('active'); if (product.requiresFlavorSelection) { openFlavorModal(product); } else { addToCart(product, 1, []); showToast(`Â¡${product.name} aÃ±adido al carrito!`); } };
            const handleCartListClick = (e) => { if (!isStoreCurrentlyOpen) return; const removeBtn = e.target.closest('.remove-from-cart-btn'); if (removeBtn) { removeFromCart(parseInt(removeBtn.dataset.index)); return; } const increaseBtn = e.target.closest('.increase-qty-btn'); if (increaseBtn) { increaseCartItemQuantity(parseInt(increaseBtn.dataset.index)); return; } const decreaseBtn = e.target.closest('.decrease-qty-btn'); if (decreaseBtn) { decreaseCartItemQuantity(parseInt(decreaseBtn.dataset.index)); return; } };
            const handleOrderFormSubmit = (e) => { e.preventDefault(); const formData = new FormData(dom.orderModal.form); const customerData = Object.fromEntries(formData.entries()); saveUserData(customerData); const subtotal = state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0); const shippingCost = (subtotal > 0 && subtotal < SHIPPING_COST_VALUE) ? SHIPPING_COST_VALUE : 0; let discount = 0; if (state.appliedCoupon && state.appliedCoupon.type === 'discount') discount = state.appliedCoupon.value; const total = subtotal + shippingCost - discount; const amount = parseFloat(customerData.amount); const cambio = (['Con Cambio', 'Efectivo'].includes(customerData.payment) && !isNaN(amount) && amount >= total) ? amount - total : 0; sendOrderToWhatsApp({ customer: customerData, items: state.cart, subtotal, shippingCost, total, cambio, coupon: state.appliedCoupon }); closeAllModals(); dom.confirmationModal.modal.classList.remove('hidden'); };
            const handleCloseConfirmation = () => { closeAllModals(); clearCart(); dom.orderModal.form.reset(); dom.orderModal.paymentSelect.dispatchEvent(new Event('change')); };
            const registerListeners = () => { 
                if(dom.searchBar) dom.searchBar.addEventListener('input', filterAndRenderProducts); 
                if(dom.categoryFilters) dom.categoryFilters.addEventListener('click', handleCategoryFilterClick); 
                if(dom.productList) dom.productList.addEventListener('click', handleProductListClick); 
                if(dom.cart.list) dom.cart.list.addEventListener('click', handleCartListClick); 
                if(dom.mobileCart.list) dom.mobileCart.list.addEventListener('click', handleCartListClick); 
                if(dom.cart.clearBtn) dom.cart.clearBtn.addEventListener('click', clearCart); 
                if(dom.cart.checkoutBtn) dom.cart.checkoutBtn.addEventListener('click', showOrderModal); 
                if(dom.mobileCart.checkoutBtn) dom.mobileCart.checkoutBtn.addEventListener('click', showOrderModal); 
                if(dom.mobileCart.openBtn) dom.mobileCart.openBtn.addEventListener('click', () => dom.mobileCart.view.classList.add('active')); 
                if(dom.mobileCart.closeBtn) dom.mobileCart.closeBtn.addEventListener('click', () => dom.mobileCart.view.classList.remove('active')); 
                if(dom.flavorModal.options) dom.flavorModal.options.addEventListener('click', (e) => handleFlavorSelection(e, dom.flavorModal)); 
                if(dom.qtyFlavorModal.options) dom.qtyFlavorModal.options.addEventListener('click', (e) => handleFlavorSelection(e, dom.qtyFlavorModal)); 
                if(dom.flavorModal.confirmBtn) dom.flavorModal.confirmBtn.addEventListener('click', () => { dom.flavorModal.modal.classList.add('hidden'); addToCart(state.currentProduct, 1, state.selectedFlavors); showToast(`Â¡${state.currentProduct.name} aÃ±adido!`); }); 
                if(dom.qtyFlavorModal.confirmBtn) dom.qtyFlavorModal.confirmBtn.addEventListener('click', () => { const quantity = parseInt(dom.qtyFlavorModal.quantityInput.value); if (quantity > 0) { dom.qtyFlavorModal.modal.classList.add('hidden'); addToCart(state.currentProduct, quantity, state.selectedFlavors); showToast(`Â¡${state.currentProduct.name} aÃ±adido!`); } }); 
                if(dom.extrasModal.modal) dom.extrasModal.modal.addEventListener('click', (e) => { const btn = e.target.closest('.add-extra-btn'); if (btn && !btn.disabled) { const productId = parseInt(btn.dataset.id); const product = ALL_PRODUCTS.find(p => p.id === productId); if (product) { addToCart(product, 1, [], true); showToast(`Â¡${product.name} aÃ±adido!`); btn.disabled = true; setTimeout(() => { btn.disabled = false; }, 1500); } } }); 
                if(dom.extrasModal.closeBtn) dom.extrasModal.closeBtn.addEventListener('click', closeAllModals); 
                if(dom.extrasModal.skipBtn) dom.extrasModal.skipBtn.addEventListener('click', closeAllModals); 
                if(dom.orderModal.form) dom.orderModal.form.addEventListener('submit', handleOrderFormSubmit); 
                if(dom.orderModal.paymentSelect) dom.orderModal.paymentSelect.addEventListener('change', () => { const isCash = ['Con Cambio', 'Efectivo'].includes(dom.orderModal.paymentSelect.value); dom.orderModal.amountContainer.classList.toggle('hidden', !isCash); updateCambio(); }); 
                if(dom.orderModal.amountInput) dom.orderModal.amountInput.addEventListener('input', () => updateCambio()); 
                if(dom.flavorModal.closeBtn) dom.flavorModal.closeBtn.addEventListener('click', closeAllModals); 
                if(dom.qtyFlavorModal.closeBtn) dom.qtyFlavorModal.closeBtn.addEventListener('click', closeAllModals); 
                if(dom.orderModal.closeBtn) dom.orderModal.closeBtn.addEventListener('click', () => { dom.orderModal.form.reset(); dom.orderModal.paymentSelect.dispatchEvent(new Event('change')); closeAllModals(); }); 
                if(dom.confirmationModal.closeBtn) dom.confirmationModal.closeBtn.addEventListener('click', handleCloseConfirmation); 
                if(dom.cart.couponSelect) dom.cart.couponSelect.addEventListener('change', (e) => applyCoupon(e.target.value)); 
                if(dom.mobileCart.couponSelect) dom.mobileCart.couponSelect.addEventListener('change', (e) => applyCoupon(e.target.value)); 
                document.body.addEventListener('click', (e) => { if (e.target.id === 'remove-coupon-btn' && !e.target.disabled) removeCoupon(); }); 
                if(dom.admin.loginBtn) dom.admin.loginBtn.addEventListener('click', () => { dom.admin.loginModal.classList.remove('hidden'); dom.admin.passwordInput.value = ''; dom.admin.passwordInput.focus(); }); 
                if(dom.admin.cancelLogin) dom.admin.cancelLogin.addEventListener('click', () => dom.admin.loginModal.classList.add('hidden')); 
                if(dom.admin.submitLogin) dom.admin.submitLogin.addEventListener('click', () => { if (dom.admin.passwordInput.value === ADMIN_PASSWORD) { dom.admin.loginModal.classList.add('hidden'); renderAdminProductList(); dom.admin.panelModal.classList.remove('hidden'); } else { alert('ContraseÃ±a incorrecta'); } }); 
                if(dom.admin.closePanel) dom.admin.closePanel.addEventListener('click', () => dom.admin.panelModal.classList.add('hidden')); 
                if(dom.admin.finishBtn) dom.admin.finishBtn.addEventListener('click', () => dom.admin.panelModal.classList.add('hidden')); 
                if(dom.admin.toggleSchedule) dom.admin.toggleSchedule.addEventListener('change', async (e) => { storeSettings.useAutoSchedule = e.target.checked; updateAdminManualControlsUI(); await saveStoreSettings(); }); 
                if(dom.admin.toggleManualOpen) dom.admin.toggleManualOpen.addEventListener('change', async (e) => { storeSettings.isManualOpen = e.target.checked; await saveStoreSettings(); }); 
                if(dom.admin.toggleHoliday) dom.admin.toggleHoliday.addEventListener('change', async (e) => { storeSettings.showHolidayNotice = e.target.checked; await saveStoreSettings(); }); 
                if(dom.giveaway.claimBtn) dom.giveaway.claimBtn.addEventListener('click', () => { dom.giveaway.modal.classList.remove('hidden'); }); 
                if(dom.giveaway.closeBtn) dom.giveaway.closeBtn.addEventListener('click', () => { dom.giveaway.modal.classList.add('hidden'); }); 
                if(dom.giveaway.form) dom.giveaway.form.addEventListener('submit', handleClaimGiveaway); 
                if(dom.admin.testGiveawayBtn) dom.admin.testGiveawayBtn.addEventListener('click', () => { const nextYear = new Date(); nextYear.setFullYear(2025, 0, 1); nextYear.setHours(0,0,0,0); document.getElementById('days').innerText = '00'; document.getElementById('hours').innerText = '00'; document.getElementById('minutes').innerText = '00'; document.getElementById('seconds').innerText = '00'; activateGiveaway(); dom.admin.panelModal.classList.add('hidden'); }); 
            };
            const init = async () => { if (dom.categoryFilters && dom.productList) { await initAuth(); const { isOpen } = checkStoreHours(); toggleOrdering(isOpen); loadState(); subscribeToSettings(); productsToRender = getAvailableProducts(); renderCategoryFilters(); filterAndRenderProducts(); renderCart(); renderExtrasModal(); registerListeners(); } else { console.error("No se pudieron encontrar los elementos principales del DOM."); } };
            init();
    });
    </script>
</body>
</html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pedidos</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        };
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
    </style>
</head>
<body class="bg-gray-100 font-sans p-4 md:p-8">

    <!-- Encabezado -->
    <header class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800">Nuestro Men√∫</h1>
        <p class="text-gray-600 mt-2">Selecciona tus productos y completa tu pedido</p>
    </header>

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Secci√≥n de Productos -->
        <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6">Productos Disponibles</h2>
            <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                <!-- Los productos se renderizar√°n aqu√≠ din√°micamente -->
            </div>
        </div>

        <!-- Secci√≥n del Carrito de Compras -->
        <div class="bg-white rounded-xl shadow-lg p-6 h-fit sticky top-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex justify-between items-center">
                Tu Carrito
                <button id="clear-cart-button" class="text-sm text-red-500 hover:text-red-700 transition-colors duration-200 hidden">Vaciar Carrito</button>
            </h2>
            <div id="cart-list" class="space-y-4 mb-6">
                <!-- Los √≠tems del carrito se renderizar√°n aqu√≠ -->
                <p id="empty-cart-message" class="text-gray-500 text-center">El carrito est√° vac√≠o.</p>
            </div>
            <div class="border-t pt-4">
                <div class="flex justify-between items-center text-xl font-bold text-gray-800">
                    <span>Subtotal:</span>
                    <span id="cart-subtotal">$0.00</span>
                </div>
                <div class="flex justify-between items-center text-gray-600 mt-2">
                    <span>Costo de env√≠o:</span>
                    <span id="shipping-cost">¬°GRATIS!</span>
                </div>
                <div class="flex justify-between items-center text-2xl font-bold text-gray-800 mt-4">
                    <span>Total:</span>
                    <span id="cart-total">$0.00</span>
                </div>
            </div>
            <button id="checkout-button" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg mt-6 hover:bg-blue-700 transition-colors duration-300 shadow-md disabled:bg-blue-400" disabled>
                Finalizar Pedido
            </button>
        </div>
    </div>

    <!-- Modal para seleccionar sabores -->
    <div id="flavor-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-8">
            <div class="flex justify-between items-center mb-4">
                <h3 id="flavor-modal-title" class="text-xl font-bold text-gray-800"></h3>
                <button id="close-flavor-modal-button" class="text-gray-400 hover:text-gray-600 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <p id="flavor-modal-subtitle" class="text-gray-600 mb-6 flex justify-between">
                <span>Puedes elegir hasta <span id="flavors-max-count"></span> sabores.</span>
                <span>Seleccionados: <span id="flavors-selected-count">0</span></span>
            </p>
            <div id="flavor-options" class="grid grid-cols-2 gap-4">
                <!-- Los botones de sabores se renderizar√°n aqu√≠ -->
            </div>
            <button id="confirm-flavors-button" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg mt-6 hover:bg-green-700 transition-colors duration-300 shadow-md disabled:bg-green-400" disabled>
                Confirmar Sabores
            </button>
        </div>
    </div>

    <!-- Modal para seleccionar cantidad y sabores (Nuevo) -->
    <div id="quantity-flavor-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-8">
            <div class="flex justify-between items-center mb-4">
                <h3 id="quantity-flavor-modal-title" class="text-xl font-bold text-gray-800"></h3>
                <button id="close-quantity-flavor-modal-button" class="text-gray-400 hover:text-gray-600 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div class="flex items-center space-x-4 my-6">
                <label for="quantity-input" class="text-lg font-semibold text-gray-700">Cantidad de piezas:</label>
                <input type="number" id="quantity-input" value="1" min="1" class="w-24 text-center border border-gray-300 rounded-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <p id="quantity-flavor-modal-subtitle" class="text-gray-600 mb-4 flex justify-between">
                <span>Puedes elegir hasta <span id="quantity-flavors-max-count"></span> sabores.</span>
                <span>Seleccionados: <span id="quantity-flavors-selected-count">0</span></span>
            </p>
            <div id="quantity-flavor-options" class="grid grid-cols-2 gap-4">
                <!-- Los botones de sabores se renderizar√°n aqu√≠ -->
            </div>

            <button id="confirm-quantity-flavors-button" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg mt-6 hover:bg-green-700 transition-colors duration-300 shadow-md disabled:bg-green-400" disabled>
                Confirmar Sabores y A√±adir
            </button>
        </div>
    </div>

    <!-- Modal del Formulario de Pedido -->
    <div id="order-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-xl p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Realiza tu Pedido</h3>
                <button id="close-modal-button" class="text-gray-400 hover:text-gray-600 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="order-form" class="space-y-4">
                <div>
                    <label for="name" class="block text-gray-700 font-semibold mb-1">Nombre del Cliente</label>
                    <input type="text" id="name" name="name" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                    <label for="address" class="block text-gray-700 font-semibold mb-1">Direcci√≥n de Entrega</label>
                    <input type="text" id="address" name="address" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div>
                    <label for="details" class="block text-gray-700 font-semibold mb-1">Caracter√≠sticas del Domicilio</label>
                    <input type="text" id="details" name="details" placeholder="Ej: depto 3, puerta azul" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="payment" class="block text-gray-700 font-semibold mb-1">Paga con:</label>
                    <select id="payment" name="payment" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="Efectivo">Efectivo</option>
                        <option value="Tarjeta">Tarjeta</option>
                        <option value="Transferencia">Transferencia</option>
                        <option value="Con Cambio">Con Cambio</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
                 <div id="amount-field-container">
                    <label for="amount" class="block text-gray-700 font-semibold mb-1">Mencione usted con cu√°nto va a pagar para que le entreguen su cambio</label>
                    <input type="text" id="amount" name="amount" class="w-full border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="">
                    <p class="text-right text-sm text-gray-500 mt-2">Total a pagar: <span id="payment-total-amount" class="font-bold text-gray-800"></span></p>
                </div>
                <div id="cambio-field" class="mt-2 text-right hidden">
                    <p class="text-lg font-bold text-gray-800">Cambio: <span id="cambio-total">$0.00</span></p>
                </div>
                <div class="text-center mt-6">
                    <p class="text-gray-600 text-sm">2452070033</p>
                </div>
                <button type="submit" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-colors duration-300 shadow-md">
                    Enviar por WhatsApp
                </button>
            </form>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n -->
    <div id="confirmation-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-8 text-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-500 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">¬°Pedido Recibido!</h3>
            <p class="text-gray-600 mb-6">Pronto nos pondremos en contacto contigo.</p>
            <button id="close-confirmation-button" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors duration-300">
                Cerrar
            </button>
        </div>
    </div>

    <script>
        // Definici√≥n de los sabores disponibles
        const flavors = ['Habanero', 'Valentina', 'Lim√≥n con Taj√≠n', 'BBQ', 'B√∫falo', 'Naturales', 'Ranch'];
        const bonelessFlavors = ['Habanero', 'BBQ', 'B√∫falo', 'Ranch'];
        
        // Definici√≥n de los umbrales y costos
        const shippingThreshold = 100; // El costo de env√≠o se aplica si el subtotal es <= a esta cantidad
        const shippingCostValue = 15.00; // Valor del costo de env√≠o

        // Array de productos disponibles con sus propiedades, incluyendo si requieren selecci√≥n de sabores
        const products = [
            { id: 1, name: 'Paquete Personal (8 pzs)', price: 85.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>`, requiresFlavorSelection: true, maxFlavors: 2, flavors: flavors, isCustomQuantity: false },
            { id: 2, name: 'Paquete D√∫o (14 pzs)', price: 135.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h-1a4 4 0 01-4-4V7a4 4 0 014-4h1a4 4 0 014 4v9a4 4 0 01-4 4zM7 20H6a4 4 0 01-4-4V7a4 4 0 014-4h1a4 4 0 014 4v9a4 4 0 01-4 4z" /></svg>`, requiresFlavorSelection: true, maxFlavors: 2, flavors: flavors, isCustomQuantity: false },
            { id: 3, name: 'Paquete Amigos (25 pzs)', price: 235.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>`, requiresFlavorSelection: true, maxFlavors: 2, flavors: flavors, isCustomQuantity: false },
            { id: 4, name: 'Paquete Familiar (35 pzs)', price: 275.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>`, requiresFlavorSelection: true, maxFlavors: 2, flavors: flavors, isCustomQuantity: false },
            { id: 5, name: 'Paquete Llenador (50 pzs)', price: 450.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.438 9.255 5 7.5 5S4.168 5.438 3 6.253v13C4.168 18.438 5.745 18 7.5 18s3.332.438 4.5 1.253m0-13C13.168 5.438 14.745 5 16.5 5c1.755 0 3.332.438 4.5 1.253v13C19.832 18.438 18.255 18 16.5 18c-1.755 0-3.332.438-4.5 1.253" /></svg>`, requiresFlavorSelection: true, maxFlavors: 2, flavors: flavors, isCustomQuantity: false },
            { id: 6, name: '1 kg (18 pzs)', price: 190.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10m-8-4h16" /></svg>`, requiresFlavorSelection: true, maxFlavors: 7, flavors: flavors, isCustomQuantity: false },
            { id: 7, name: '1/2 kg (10 pzs)', price: 95.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10m-8-4h16" /></svg>`, requiresFlavorSelection: true, maxFlavors: 7, flavors: flavors, isCustomQuantity: false },
            { id: 8, name: 'Orden (6 pzs)', price: 65.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10m-8-4h16" /></svg>`, requiresFlavorSelection: true, maxFlavors: 1, flavors: flavors, isCustomQuantity: false },
            { id: 9, name: 'Orden Kids (4 pzs)', price: 35.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10m-8-4h16" /></svg>`, requiresFlavorSelection: true, maxFlavors: 1, flavors: flavors, isCustomQuantity: false },
            { id: 10, name: 'Orden de Papas Fritas', price: 45.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0 0l3-3m-3 3l-3-3M6 13V3m0 10L3 10m3 3l3-3M18 13V3m0 10l3-3m-3 3l-3-3" /></svg>`, requiresFlavorSelection: false, isCustomQuantity: false },
            { id: 11, name: 'Aderezo Ranch', price: 20.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9a2 2 0 114 0c0 1.223-.62 2-1.5 2.5a1.5 1.5 0 00-.5 2.5v1m.5-4h.5a.5.5 0 01.5.5v1a.5.5 0 01-.5.5h-.5a.5.5 0 01-.5-.5v-1a.5.5 0 01.5-.5z" /></svg>`, requiresFlavorSelection: false, isCustomQuantity: false },
            { id: 12, name: 'Coca-Cola 600 ml', price: 30.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 22a7 7 0 007-7h-2a5 5 0 01-5 5v-2a3 3 0 00-3-3v-2a1 1 0 011-1h1V8h-2c-1.105 0-2 .895-2 2v2a3 3 0 003 3v2a5 5 0 015-5h2a7 7 0 00-7-7" /></svg>`, requiresFlavorSelection: false, isCustomQuantity: false },
            { id: 13, name: 'Manzanita 600 ml', price: 30.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h8m-4-4v8m5 8a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`, requiresFlavorSelection: false, isCustomQuantity: false },
            { id: 14, name: 'Lunes x Pieza', price: 6.50, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673c2.227 0 3.75-1.921 3.256-4.103l-1.18-5.328a2.535 2.535 0 00-2.478-1.996h-2.102c-.93 0-1.821.5-2.298 1.353l-2.732 4.966c-.504 1.134.427 2.478 1.621 2.478zm-4.733-4.887l2.846-5.161a2.535 2.535 0 012.298-1.353h2.102c.93 0 1.821.5-2.298 1.353l2.732 4.966c.504 1.134-.427 2.478-1.621 2.478z" /></svg>`, requiresFlavorSelection: true, maxFlavors: 2, flavors: flavors, isCustomQuantity: true },
            { id: 15, name: 'Martes x Pieza', price: 7.50, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`, requiresFlavorSelection: true, maxFlavors: 2, flavors: flavors, isCustomQuantity: true },
            { id: 16, name: 'Boneless x Pieza', price: 10.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673c2.227 0 3.75-1.921 3.256-4.103l-1.18-5.328a2.535 2.535 0 00-2.478-1.996h-2.102c-.93 0-1.821.5-2.298 1.353l-2.732 4.966c-.504 1.134.427 2.478 1.621 2.478z" /></svg>`, requiresFlavorSelection: true, maxFlavors: 2, flavors: bonelessFlavors, isCustomQuantity: true },
            { id: 17, name: 'Orden Boneless (10 pzs)', price: 95.00, icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10m-8-4h16" /></svg>`, requiresFlavorSelection: true, maxFlavors: 2, flavors: bonelessFlavors, isCustomQuantity: false },
        ];

        // Estado del carrito de compras
        let cart = [];

        // Referencias a elementos del DOM
        const productList = document.getElementById('product-list');
        const cartList = document.getElementById('cart-list');
        const cartSubtotalSpan = document.getElementById('cart-subtotal');
        const shippingCostSpan = document.getElementById('shipping-cost');
        const cartTotalSpan = document.getElementById('cart-total');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const checkoutButton = document.getElementById('checkout-button');
        const orderModal = document.getElementById('order-modal');
        const closeButton = document.getElementById('close-modal-button');
        const orderForm = document.getElementById('order-form');
        const confirmationModal = document.getElementById('confirmation-modal');
        const closeConfirmationButton = document.getElementById('close-confirmation-button');
        const flavorModal = document.getElementById('flavor-modal');
        const closeFlavorModalButton = document.getElementById('close-flavor-modal-button');
        const flavorModalTitle = document.getElementById('flavor-modal-title');
        const flavorModalSubtitle = document.getElementById('flavor-modal-subtitle');
        const flavorOptions = document.getElementById('flavor-options');
        const confirmFlavorsButton = document.getElementById('confirm-flavors-button');
        const paymentSelect = document.getElementById('payment');
        const amountInput = document.getElementById('amount');
        const cambioField = document.getElementById('cambio-field');
        const cambioTotalSpan = document.getElementById('cambio-total');
        const clearCartButton = document.getElementById('clear-cart-button');
        const amountFieldContainer = document.getElementById('amount-field-container');
        const quantityFlavorModal = document.getElementById('quantity-flavor-modal');
        const closeQuantityFlavorModalButton = document.getElementById('close-quantity-flavor-modal-button');
        const quantityFlavorModalTitle = document.getElementById('quantity-flavor-modal-title');
        const quantityFlavorModalSubtitle = document.getElementById('quantity-flavor-modal-subtitle');
        const quantityFlavorOptions = document.getElementById('quantity-flavor-options');
        const confirmQuantityFlavorsButton = document.getElementById('confirm-quantity-flavors-button');
        const quantityInput = document.getElementById('quantity-input');
        const paymentTotalAmount = document.getElementById('payment-total-amount');


        // Variables para la selecci√≥n de sabores
        let selectedFlavors = [];
        let currentProduct = null;
        
        // Funci√≥n para renderizar la lista de productos
        function renderProducts() {
            productList.innerHTML = '';
            products.forEach(product => {
                const productCard = document.createElement('div');
                // Estilo del card con gradiente y esquinas redondeadas
                productCard.className = 'bg-gradient-to-br from-orange-400 to-orange-600 text-white rounded-2xl p-6 shadow-xl flex flex-col items-center justify-center transform transition-transform duration-200 hover:scale-105 hover:shadow-2xl cursor-pointer';
                productCard.innerHTML = `
                    ${product.icon}
                    <h3 class="text-xl font-bold text-center mb-1">${product.name}</h3>
                    <p class="text-lg font-semibold">$${product.price.toFixed(2)}</p>
                    ${(product.name === 'Lunes x Pieza' || product.name === 'Martes x Pieza') ? `<p class="text-xs text-gray-200 mt-1">V√°lido solo los ${product.name.split(' ')[0]}s</p>` : ''}
                    <button data-id="${product.id}" data-requires-flavor="${product.requiresFlavorSelection}" data-is-custom-quantity="${product.isCustomQuantity}" class="add-to-cart-btn mt-auto bg-white text-orange-600 font-bold py-2 px-6 rounded-xl hover:bg-gray-100 transition-colors duration-300 shadow-md text-sm">
                        A√±adir
                    </button>
                `;
                productList.appendChild(productCard);
            });
        }

        // Funci√≥n para renderizar el carrito
        function renderCart() {
            cartList.innerHTML = '';
            if (cart.length === 0) {
                emptyCartMessage.classList.remove('hidden');
                checkoutButton.disabled = true;
                clearCartButton.classList.add('hidden');
            } else {
                emptyCartMessage.classList.add('hidden');
                checkoutButton.disabled = false;
                clearCartButton.classList.remove('hidden');
                cart.forEach((item, index) => { // Agregu√© el √≠ndice para identificar el elemento
                    const cartItem = document.createElement('div');
                    cartItem.className = 'flex justify-between items-center p-3 bg-gray-50 rounded-lg';
                    
                    // Mostrar los sabores seleccionados si existen
                    let flavorsText = '';
                    if (item.flavors && item.flavors.length > 0) {
                        flavorsText = `<p class="text-xs text-gray-500 mt-1">Sabores: ${item.flavors.join(', ')}</p>`;
                    }

                    cartItem.innerHTML = `
                        <div>
                            <div class="flex items-center">
                                <span class="font-bold text-gray-800">${item.quantity}x</span>
                                <span class="ml-3 text-gray-700">${item.name}</span>
                            </div>
                            ${flavorsText}
                        </div>
                        <div class="flex items-center">
                            <span class="text-blue-600 font-semibold">$${(item.price * item.quantity).toFixed(2)}</span>
                            <div class="flex items-center ml-4 space-x-2">
                                <button data-index="${index}" class="remove-from-cart-btn text-red-500 hover:text-red-700 transition-colors duration-200">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.013 21H7.987a2 2 0 01-1.92-1.858L5 7m5 4v6m4-6v6m1-9V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                    cartList.appendChild(cartItem);
                });
            }
            updateCartTotal();
        }

        // Funci√≥n para actualizar el total del carrito y el costo de env√≠o
        function updateCartTotal() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            let shippingCost = 0;
            if (subtotal > 0 && subtotal <= shippingThreshold) {
                shippingCost = shippingCostValue;
                shippingCostSpan.textContent = `$${shippingCost.toFixed(2)}`;
                shippingCostSpan.classList.remove('text-gray-600', 'text-green-500');
                shippingCostSpan.classList.add('text-red-500');
            } else if (subtotal > shippingThreshold) {
                shippingCost = 0;
                shippingCostSpan.textContent = '¬°GRATIS!';
                shippingCostSpan.classList.remove('text-red-500', 'text-gray-600');
                shippingCostSpan.classList.add('text-green-500');
            } else {
                 shippingCost = 0;
                shippingCostSpan.textContent = '¬°GRATIS!';
                shippingCostSpan.classList.remove('text-red-500', 'text-green-500');
                shippingCostSpan.classList.add('text-gray-600');
            }

            const total = subtotal + shippingCost;
            cartSubtotalSpan.textContent = `$${subtotal.toFixed(2)}`;
            cartTotalSpan.textContent = `$${total.toFixed(2)}`;
            
            // Actualizar el c√°lculo del cambio si el modal est√° visible
            if (!orderModal.classList.contains('hidden')) {
                updateCambio();
                paymentTotalAmount.textContent = `$${total.toFixed(2)}`;
            }
        }

        // Funci√≥n para a√±adir un producto al carrito
        function addToCart(product, quantity = 1, flavors = []) {
            // Encuentra un √≠tem id√©ntico en el carrito (mismo id y sabores)
            const existingItem = cart.find(item => item.id === product.id && JSON.stringify(item.flavors) === JSON.stringify(flavors));
            
            if (existingItem) {
                // Si existe, aumenta su cantidad
                existingItem.quantity += quantity;
            } else {
                // Si no existe, agr√©galo
                cart.push({ ...product, quantity: quantity, flavors: flavors });
            }
            renderCart();
        }

        // Funci√≥n para eliminar un producto del carrito
        function removeFromCart(productIndex) {
            cart.splice(productIndex, 1);
            renderCart();
        }
        
        // Funci√≥n para vaciar el carrito
        function clearCart() {
            cart = [];
            renderCart();
        }

        // Funci√≥n para renderizar el modal de sabores
        function renderFlavorModal(product) {
            currentProduct = product;
            selectedFlavors = [];
            flavorModalTitle.textContent = `Elige tus Sabores (${product.name})`;
            document.getElementById('flavors-max-count').textContent = product.maxFlavors;
            document.getElementById('flavors-selected-count').textContent = 0;
            flavorOptions.innerHTML = '';

            const flavorsToUse = product.flavors;
            flavorsToUse.forEach(flavor => {
                const flavorButton = document.createElement('button');
                flavorButton.type = 'button';
                const buttonClasses = (product.maxFlavors === 1) ? 'flavor-button bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-full transition-colors duration-200 hover:bg-gray-300 single-select' : 'flavor-button bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-full transition-colors duration-200 hover:bg-gray-300';
                flavorButton.className = buttonClasses;
                flavorButton.textContent = flavor;
                flavorButton.dataset.flavor = flavor;
                flavorOptions.appendChild(flavorButton);
            });

            confirmFlavorsButton.disabled = true;
            flavorModal.classList.remove('hidden');
        }
        
        // Funci√≥n para renderizar el modal de cantidad y sabores (Nuevo)
        function renderQuantityFlavorModal(product) {
            currentProduct = product;
            selectedFlavors = [];
            quantityInput.value = 1; // Resetea la cantidad
            quantityFlavorModalTitle.textContent = `A√±adir "${product.name}"`;
            document.getElementById('quantity-flavors-max-count').textContent = product.maxFlavors;
            document.getElementById('quantity-flavors-selected-count').textContent = 0;
            quantityFlavorOptions.innerHTML = '';
            
            const flavorsToUse = product.flavors;
            flavorsToUse.forEach(flavor => {
                const flavorButton = document.createElement('button');
                flavorButton.type = 'button';
                const buttonClasses = (product.maxFlavors === 1) ? 'flavor-button bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-full transition-colors duration-200 hover:bg-gray-300 single-select' : 'flavor-button bg-gray-200 text-gray-700 font-semibold py-3 px-4 rounded-full transition-colors duration-200 hover:bg-gray-300';
                flavorButton.className = buttonClasses;
                flavorButton.textContent = flavor;
                flavorButton.dataset.flavor = flavor;
                quantityFlavorOptions.appendChild(flavorButton);
            });

            confirmQuantityFlavorsButton.disabled = true;
            quantityFlavorModal.classList.remove('hidden');
        }

        // Funci√≥n para actualizar el c√°lculo del cambio
        function updateCambio() {
            const amount = parseFloat(amountInput.value);
            const total = parseFloat(cartTotalSpan.textContent.replace('$', ''));
            
            if ((paymentSelect.value === 'Con Cambio' || paymentSelect.value === 'Efectivo') && !isNaN(amount) && amount >= total) {
                const cambio = amount - total;
                cambioTotalSpan.textContent = `$${cambio.toFixed(2)}`;
                cambioField.classList.remove('hidden');
            } else {
                cambioField.classList.add('hidden');
                cambioTotalSpan.textContent = `$0.00`;
            }
        }

        // Event listeners
        document.addEventListener('click', (e) => {
            // Manejar clics para a√±adir al carrito o abrir el modal de sabores/cantidad
            const addBtn = e.target.closest('.add-to-cart-btn');
            if (addBtn) {
                const productId = parseInt(addBtn.dataset.id);
                const requiresFlavorSelection = addBtn.dataset.requiresFlavor === 'true';
                const isCustomQuantity = addBtn.dataset.isCustomQuantity === 'true';
                const product = products.find(p => p.id === productId);

                if (isCustomQuantity) {
                    renderQuantityFlavorModal(product);
                } else if (requiresFlavorSelection) {
                    renderFlavorModal(product);
                } else {
                    addToCart(product);
                }
            }

            // Manejar clics para eliminar el producto con el bote de basura
            const removeBtn = e.target.closest('.remove-from-cart-btn');
            if (removeBtn) {
                const productIndex = parseInt(removeBtn.dataset.index);
                removeFromCart(productIndex);
            }
            
            // Manejar clics en los botones de sabores del modal de selecci√≥n normal
            if (e.target.matches('#flavor-options .flavor-button')) {
                const flavor = e.target.dataset.flavor;
                const maxFlavors = currentProduct.maxFlavors;

                if (maxFlavors === 1) {
                    if (!selectedFlavors.includes(flavor)) {
                        selectedFlavors = [flavor];
                        document.querySelectorAll('#flavor-options .flavor-button').forEach(btn => {
                            btn.classList.remove('bg-orange-500', 'text-white');
                            btn.classList.add('bg-gray-200', 'text-gray-700');
                            btn.disabled = false;
                        });
                        e.target.classList.remove('bg-gray-200', 'text-gray-700');
                        e.target.classList.add('bg-orange-500', 'text-white');
                    } else {
                        selectedFlavors = [];
                        e.target.classList.remove('bg-orange-500', 'text-white');
                        e.target.classList.add('bg-gray-200', 'text-gray-700');
                    }
                } else {
                    e.target.classList.toggle('bg-orange-500');
                    e.target.classList.toggle('text-white');
                    e.target.classList.toggle('bg-gray-200');
                    e.target.classList.toggle('text-gray-700');

                    if (selectedFlavors.includes(flavor)) {
                        selectedFlavors = selectedFlavors.filter(f => f !== flavor);
                    } else {
                        if (selectedFlavors.length < maxFlavors) {
                            selectedFlavors.push(flavor);
                        }
                    }

                    if (selectedFlavors.length >= maxFlavors) {
                        document.querySelectorAll('#flavor-options .flavor-button:not(.bg-orange-500)').forEach(btn => {
                            btn.disabled = true;
                        });
                    } else {
                        document.querySelectorAll('#flavor-options .flavor-button').forEach(btn => {
                            btn.disabled = false;
                        });
                    }
                }
                document.getElementById('flavors-selected-count').textContent = selectedFlavors.length;
                confirmFlavorsButton.disabled = selectedFlavors.length === 0;
            }

            // Manejar clics en los botones de sabores del modal de cantidad
            if (e.target.matches('#quantity-flavor-options .flavor-button')) {
                const flavor = e.target.dataset.flavor;
                const maxFlavors = currentProduct.maxFlavors;

                if (maxFlavors === 1) {
                    if (!selectedFlavors.includes(flavor)) {
                        selectedFlavors = [flavor];
                        document.querySelectorAll('#quantity-flavor-options .flavor-button').forEach(btn => {
                            btn.classList.remove('bg-orange-500', 'text-white');
                            btn.classList.add('bg-gray-200', 'text-gray-700');
                            btn.disabled = false;
                        });
                        e.target.classList.remove('bg-gray-200', 'text-gray-700');
                        e.target.classList.add('bg-orange-500', 'text-white');
                    } else {
                        selectedFlavors = [];
                        e.target.classList.remove('bg-orange-500', 'text-white');
                        e.target.classList.add('bg-gray-200', 'text-gray-700');
                    }
                } else {
                    e.target.classList.toggle('bg-orange-500');
                    e.target.classList.toggle('text-white');
                    e.target.classList.toggle('bg-gray-200');
                    e.target.classList.toggle('text-gray-700');

                    if (selectedFlavors.includes(flavor)) {
                        selectedFlavors = selectedFlavors.filter(f => f !== flavor);
                    } else {
                        if (selectedFlavors.length < maxFlavors) {
                            selectedFlavors.push(flavor);
                        }
                    }

                    if (selectedFlavors.length >= maxFlavors) {
                        document.querySelectorAll('#quantity-flavor-options .flavor-button:not(.bg-orange-500)').forEach(btn => {
                            btn.disabled = true;
                        });
                    } else {
                        document.querySelectorAll('#quantity-flavor-options .flavor-button').forEach(btn => {
                            btn.disabled = false;
                        });
                    }
                }
                document.getElementById('quantity-flavors-selected-count').textContent = selectedFlavors.length;
                confirmQuantityFlavorsButton.disabled = selectedFlavors.length === 0;
            }
        });

        // Evento de cambio para el campo de pago
        paymentSelect.addEventListener('change', (e) => {
            const total = parseFloat(cartTotalSpan.textContent.replace('$', ''));
            const selectedPayment = e.target.value;

            // Mostrar el campo de monto de pago solo para Efectivo y Con Cambio
            if (selectedPayment === 'Con Cambio' || selectedPayment === 'Efectivo') {
                amountFieldContainer.classList.remove('hidden');
            } else {
                amountFieldContainer.classList.add('hidden');
            }

            // Comportamiento espec√≠fico para cada opci√≥n
            if (selectedPayment === 'Con Cambio') {
                amountInput.value = total.toFixed(2);
            } else if (selectedPayment === 'Efectivo') {
                amountInput.value = '';
            } else {
                amountInput.value = '';
            }
            updateCambio();
        });

        // Evento para el c√°lculo del cambio al escribir en el campo
        amountInput.addEventListener('input', updateCambio);

        // Mostrar modal de pedido
        checkoutButton.addEventListener('click', () => {
            const total = parseFloat(cartTotalSpan.textContent.replace('$', ''));
            paymentTotalAmount.textContent = `$${total.toFixed(2)}`;

            const selectedPayment = paymentSelect.value;
            if (selectedPayment === 'Con Cambio') {
                amountInput.value = total.toFixed(2);
            } else if (selectedPayment === 'Efectivo') {
                amountInput.value = '';
            } else {
                amountInput.value = '';
            }
            orderModal.classList.remove('hidden');
        });

        // Cerrar modal de sabores
        closeFlavorModalButton.addEventListener('click', () => {
            flavorModal.classList.add('hidden');
        });

        // Cerrar modal de cantidad y sabores (Nuevo)
        closeQuantityFlavorModalButton.addEventListener('click', () => {
            quantityFlavorModal.classList.add('hidden');
        });

        // Confirmar sabores y a√±adir al carrito (modal normal)
        confirmFlavorsButton.addEventListener('click', () => {
            addToCart(currentProduct, 1, selectedFlavors); // Cantidad por defecto de 1
            flavorModal.classList.add('hidden');
        });

        // Confirmar sabores y a√±adir al carrito (modal de cantidad)
        confirmQuantityFlavorsButton.addEventListener('click', () => {
            const quantity = parseInt(quantityInput.value);
            if (quantity > 0) {
                addToCart(currentProduct, quantity, selectedFlavors);
                quantityFlavorModal.classList.add('hidden');
            }
        });


        // Cerrar modal de pedido
        closeButton.addEventListener('click', () => {
            orderModal.classList.add('hidden');
        });

        // Cerrar modal de confirmaci√≥n
        closeConfirmationButton.addEventListener('click', () => {
            confirmationModal.classList.add('hidden');
            orderModal.classList.add('hidden');
            // Limpiar el carrito y el formulario despu√©s de confirmar
            cart = [];
            orderForm.reset();
            renderCart();
        });
        
        // Vaciar carrito
        clearCartButton.addEventListener('click', clearCart);

        // Funci√≥n para generar y enviar el pedido a WhatsApp
        function sendOrderToWhatsApp(orderDetails) {
            // Reemplaza '522452070033' con tu n√∫mero de tel√©fono de WhatsApp (incluyendo c√≥digo de pa√≠s)
            const phoneNumber = '522452070033'; 
            let message = `¬°Hola! üëã Tengo un nuevo pedido:\n\n`;

            // Agregar los detalles del cliente
            message += `*Cliente*: ${orderDetails.customer.name}\n`;
            message += `*Tel√©fono*: ${orderDetails.customer.phone}\n`;
            message += `*Direcci√≥n*: ${orderDetails.customer.address}\n`;
            if (orderDetails.customer.details) {
                message += `*Caracter√≠sticas*: ${orderDetails.customer.details}\n`;
            }
            message += `\n*Forma de pago*: ${orderDetails.customer.payment}`;
            if (orderDetails.customer.amount) {
                 message += ` (paga con: $${parseFloat(orderDetails.customer.amount).toFixed(2)})`;
            }
            if (orderDetails.cambio > 0) {
                 message += `\n*Cambio*: $${orderDetails.cambio.toFixed(2)}\n`;
            }
            message += `\n`;


            // Agregar los detalles del pedido
            message += `*Productos*:\n`;
            orderDetails.items.forEach(item => {
                message += `- ${item.quantity}x ${item.name}`;
                if (item.flavors && item.flavors.length > 0) {
                    message += ` (Sabores: ${item.flavors.join(', ')})`;
                }
                message += ` ($${item.price.toFixed(2)} c/u)\n`;
            });

            // Agregar el total
            message += `\n*Subtotal*: $${orderDetails.subtotal.toFixed(2)}\n`;
            message += `*Costo de env√≠o*: ${orderDetails.shippingCost > 0 ? '$' + orderDetails.shippingCost.toFixed(2) : '¬°GRATIS!'}\n`;
            message += `*Total*: $${orderDetails.total.toFixed(2)}\n`;

            // Codificar el mensaje para la URL de WhatsApp
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodedMessage}`;

            // Abrir el enlace en una nueva ventana
            window.open(whatsappUrl, '_blank');
        }

        // Manejar el env√≠o del formulario de pedido
        orderForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Obtener los datos del formulario de forma segura
            const customerData = {
                name: document.getElementById('name')?.value || '',
                address: document.getElementById('address')?.value || '',
                phone: document.getElementById('phone')?.value || '',
                details: document.getElementById('details')?.value || '',
                payment: document.getElementById('payment')?.value || '',
                amount: document.getElementById('amount')?.value || '',
            };

            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            let shippingCost = 0;
            if (subtotal > 0 && subtotal <= shippingThreshold) {
                shippingCost = shippingCostValue;
            }
            const total = subtotal + shippingCost;
            const amount = parseFloat(customerData.amount);
            const cambio = (customerData.payment === 'Con Cambio' || customerData.payment === 'Efectivo') && !isNaN(amount) && amount >= total ? amount - total : 0;
            
            const orderDetails = {
                customer: customerData,
                items: cart,
                subtotal: subtotal,
                shippingCost: shippingCost,
                total: total,
                cambio: cambio,
            };

            // Enviar el pedido a WhatsApp
            sendOrderToWhatsApp(orderDetails);

            // Ocultar el modal del formulario y mostrar el de confirmaci√≥n
            orderModal.classList.add('hidden');
            confirmationModal.classList.remove('hidden');
        });

        // Iniciar la aplicaci√≥n
        renderProducts();
        renderCart();

    </script>
</body>
</html>
```
